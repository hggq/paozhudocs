<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>PaoZhu C++ Web Frameworks</title>
    <style>
        /* Light mode */
        prefers-color-scheme:light
        code{
            background-color: #EEE;
            border-radius: 5px;
            padding: 3px;
        }
        @media (prefers-color-scheme: light) {
        body {
            color: black;
            background-color: white;
        }
        body pre {
            padding: 5px;
            overflow: auto;
            font-size: 85%;
            line-height: 1.45;
            background-color: #EEE;
            border-radius: 6px;
        }
 
        body pre {
            word-wrap: normal;
        }
        body pre > code {
            padding: 0;
            margin: 0;
            font-size: 100%;
            word-break: normal;
            white-space: pre;
            background: transparent;
            border: 0;
        }
 
        body pre > code {
            white-space: pre-wrap;
        }
        code{
            background-color: #EEE;
            border-radius: 5px;
            padding: 3px;
        }

        }

        /* Dark mode */
        @media (prefers-color-scheme: dark) {
        body {
            color: white;
            background-color: black;
        }

        body pre {
            padding: 5px;
            overflow: auto;
            font-size: 85%;
            line-height: 1.45;
            background-color: #333;
            border-radius: 6px;
        }
 
        body pre {
            word-wrap: normal;
        }
        body pre > code {
            padding: 0;
            margin: 0;
            font-size: 100%;
            word-break: normal;
            white-space: pre;
            background: transparent;
            border: 0;
        }
 
        body pre > code {
            white-space: pre-wrap;
        }

        code{
            background-color: #333;
            border-radius: 5px;
            padding: 3px;
        }
        }

        @media (min-width: 1200px) {
            .container {
                width: 1080px;
                margin: 0 auto;
            }
        }
    </style>

</head>

<body>
    <div class="container">
        <h3><strong>ç®€ä»‹</strong></h3>
        <p>paozhuæ˜¯ä¸€æ¬¾C++ Webå¼€å‘æ¡†æ¶ï¼Œå†…ç½®HTTP/1 HTTP/2 ORM,å¯ä»¥è½»æ¾ä¼˜é›…å†™Webç¨‹åºï¼Œæ‰“ç ´ä»¥å¾€C++å†™Webç¨‹åºä¸æ–¹ä¾¿é—®é¢˜ã€‚</p>
        <p>paozhuç¼–å†™äº†Webå¼€å‘åº•å±‚è®¾æ–½ï¼Œæ¯”å¦‚å¤šåŸŸåç»‘å®šã€SSLè¯ä¹¦ç®¡ç†ã€Cookieã€Sessionã€HTMLè¡¨å•ç®¡ç† ã€URLå¤„ç†ã€æ–‡ä»¶ä¸Šä¼ ä¸‹è½½ã€HttpClientå®¢æˆ·ç«¯ã€æ•°æ®åº“è¿æ¥ORMã€WebSocketã€æ—¥å¿—ï¼Œæ¶µç›–Webå¼€å‘åŸºç¡€ã€‚</p>
        <p>æ¡†æ¶åŸºäºC++20ä¸ºåŸºç¡€ï¼Œä¸€ä¸ªæ˜¯ä½¿ç”¨æ–°æ ‡å‡†ï¼Œç¼–è¯‘å™¨æ”¯æŒå®Œæ•´ï¼Œä¸€ä¸ªæ˜¯è®©ä»£ç æ›´åŠ ç°ä»£åŒ–ï¼Œæ¡†æ¶å¼€å¯äº†ASANå’Œæ‰€æœ‰é”™è¯¯æç¤ºï¼Œæ–¹ä¾¿å¼€å‘é˜¶æ®µå‘ç°é—®é¢˜ï¼Œä¹Ÿå¯ä»¥è¿è¡Œæ—¶å€™ç»“åˆcoredumpctlå·¥å…·ï¼ŒæŸ¥çœ‹å„ä¸ªçº¿ç¨‹å†…å­˜æ ˆã€‚é…åˆæ™ºèƒ½æŒ‡é’ˆåŸºæœ¬æœç»å†…å­˜æ³„éœ²å’Œè¶Šç•Œé—®é¢˜ï¼Œæ¡†æ¶ç›®å‰åŸºæœ¬æ²¡æœ‰ç¢°åˆ°å†…å­˜æ³„éœ²æˆ–å´©æºƒæƒ…å†µã€‚</p>
        <p>paozhuä½¿ç”¨C++ï¼Œä¸»è¦æ˜¯è€ƒè™‘æ¥å…¥å¤§æ¨¡å‹ï¼ˆCUDAã€æ–‡ä»¶å­˜å‚¨ã€ç½‘ç»œã€å†…å­˜æ“ä½œï¼‰ã€å¯¹æ¯”ä¸‹GO JAVA RUSTï¼Œéƒ½ä¸æ˜¯å¾ˆå®Œç¾ï¼ŒC++ä¹Ÿä¸å®Œç¾ï¼ŒRUSTè¯­æ³•ä¸å¥½çœ‹ã€GOç®€å•ä½†æ˜¯å¤§æ¨¡å‹ç­‰æ²¡æœ‰å¾ˆæ·±åšæ–‡åŒ–ã€‚ç›®å‰ç»éªŒæ˜¯ASANå’Œcoredumpctlä¸¤ä¸ªå·¥å…·ä¹Ÿèƒ½ä¿è¯C++è´¨é‡ï¼Œæ–°ç¼–è¯‘å™¨ä¹Ÿèƒ½æç¤ºä¸€éƒ¨åˆ†ã€‚</p>
        <h3>paozhuç‰¹è‰²</h3>
        <ol>
        <li>æ”¯æŒHTTP2ã€‚</li>
        <li>å†…ç½®ORMï¼ˆè‡ªç ”MySQLåè®®ï¼‰ï¼Œæ”¯æŒåç¨‹æ¨¡å¼ã€‚</li>
        <li>å¤šåŸŸåç®¡ç†ã€SAASæ¨¡å¼æ”¯æŒã€‚</li>
        <li>IOçº¿ç¨‹å’Œä¸šåŠ¡çº¿ç¨‹åˆ†å¼€ã€‚</li>
        <li>å†…ç½®å¾®å‹å¯¹è±¡ï¼ŒJSONå¯¼å…¥å¯¼å‡ºï¼Œç±»ä¼¼è„šæœ¬è¯­è¨€ä¸­å˜é‡ã€‚</li>
        <li>å†…ç½®FastCGI æ”¯æŒPHP</li>
        </ol>
        </div>
        <div class="container">
        <h3>paozhuéœ€æ±‚ç¯å¢ƒ</h3>
        <p>paozhuæ”¯æŒ<code>MacOS</code>ã€<code>Linux</code>ã€<code>Windows</code>ç³»ç»Ÿã€‚</p>
        <p>ä¾èµ–ç¬¬ä¸‰æ–¹å¼€å‘åŒ…</p>
        <p><code>OpenSSL</code> <code>Zlib</code> <code>Brotli</code> <code>ASIO</code></p>
        <p>å¯é€‰ç¬¬ä¸‰æ–¹åŒ…</p>
        <p><code>GD</code> <code>qrencode</code></p>
        <p>æ¡†æ¶åŸºäºC++20ä»¥ä¸Šï¼Œç¡®ä¿ä½ çš„ç³»ç»Ÿæ”¯æŒçš„ç¼–è¯‘å™¨æ”¯æŒC++20ã€‚</p>
        <ul>
        <li><code>MacOS</code> å¿…é¡»<code>MacOS 11 BigSur</code>ä»¥ä¸Šï¼Œæœ€å¥½æ˜¯ <code>MacOS 14 Sonoma</code></li>
        <li><code>Ubuntu</code> å¿…é¡»æ˜¯22.04ä»¥ä¸Š</li>
        <li><code>RockyLinux</code> <code>AlmaLinux</code> å¿…é¡»æ˜¯9.1ä»¥ä¸Š</li>
        <li><code>Windows</code> å¿…é¡»æ˜¯Win10 ç¼–è¯‘å™¨æœ€å¥½19.25ä»¥ä¸Šã€‚</li>
        </ul>
    </div>
    <div class="container">
        <h3>paozhuå®‰è£…</h3>
        <p>åˆ°å®˜æ–¹githubåº“ï¼š<a href="https://github.com/hggq/paozhu" target="_blank">https://github.com/hggq/paozhu</a></p>
        <ul>
        <li><a href="macos.html" target="_blank">MacOSå®‰è£…</a> å‚è€ƒ</li>
        <li><a href="ubuntu.html" target="_blank">Ubuntuå®‰è£…</a> å‚è€ƒ</li>
        <li><a href="linux.html" target="_blank">RockyLinux AlmaLinux</a> å®‰è£… å‚è€ƒ</li>
        <li>Windows å®‰è£… å‚è€ƒ</li>
        </ul>
    </div>
    <div class="container">
        <h3>paozhuå…¥é—¨</h3>
        <h4>Hello, World ä¾‹å­</h4>
        <pre><code class="language-C++">
        //@urlpath(null,plaintext)
        asio::awaitable&lt;std::string&gt; techempowerplaintext(std::shared_ptr&lt;httppeer&gt; peer)
        {
            peer-&gt;type(&quot;text/plain; charset=UTF-8&quot;);
            peer-&gt;set_header(&quot;Date&quot;, get_gmttime());
            peer-&gt;output = &quot;Hello, World!&quot;;
            co_return &quot;&quot;;
        }
        
        </code></pre>
    </div>
    <div class="container">
        <h3>æ³¨è§£åŸç†</h3>
        <p>æ‰€æœ‰æ³¨è§£å‡½æ•°å¿…é¡»æ”¾åœ¨ <code>controller/src</code> ç›®å½•ä¸‹</p>
        <p>ç¼–è¯‘æ—¶å€™ä½¿ç”¨CMake Hookï¼Œå…ˆç¼–è¯‘ä¸€ä¸ªå¯ä»¥ä½¿ç”¨çš„æ³¨è§£å¤„ç†ç¨‹åºï¼Œç„¶åæ‰§è¡Œè¿™ä¸ªç¨‹åºå¤„ç†  <code>controller/src</code>
        ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼Œæå–<code>//@urlpath(null,plaintext)</code>æ ¼å¼çš„å‡½æ•°ï¼Œç„¶ååˆ›å»ºç›¸åº”çš„å¤´æ–‡ä»¶ï¼Œç„¶åç”Ÿæˆ
        æ³¨è§£å‡½æ•°ï¼Œä¿å­˜æ˜ å°„å‡½æ•°åˆ° <code>common/autocontrolmethod.hpp</code> æ–‡ä»¶ã€‚</p>
        <p>æ˜¯ä¸æ˜¯å¾ˆæœ‰Java Sprint Bootå‘³é“ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ¯•ç«Ÿä¼˜é›…å†™URLå’Œå‡½æ•°æ˜ å°„å…³ç³»ã€‚</p>
    </div>
    <div class="container">     
        <h3>æ³¨è§£ä»‹ç»</h3>
        <p><code>//@urlpath(null,plaintext)</code> ä¸ºæ³¨è§£å‡½æ•°ï¼Œä¸urlæ˜ å°„ï¼Œæ¯”å¦‚ http://localhost/plaintext ä¼šè®¿é—®åˆ°<code>plaintext</code> çš„æ³¨è§£å‡½æ•°ã€‚</p>
        <p>nullè¡¨ç¤ºè®¿é—®plaintextä¹‹å‰å¿…é¡»å…ˆæ‰§è¡Œçš„æ³¨è§£å‡½æ•°ï¼Œä¾‹å¦‚ï¼šå¸¦æƒé™çš„åå°ï¼Œéœ€è¦éªŒè¯æ˜¯å¦ç™»å½•</p>
        <p><code>//@urlpath(islogin,plaintext)</code> è¿™æ ·å¿…é¡»å…ˆæ‰§è¡Œ<code>islogin</code>çš„æ³¨è§£ï¼Œè¿”å›<code>OK</code>è¡¨ç¤ºæˆåŠŸã€‚</p>
        <pre><code class="language-C++">//@urlpath(null, islogin)
        asio::awaitable&lt;std::string&gt; checklogin(std::shared_ptr&lt;httppeer&gt; peer)
        {
            httppeer &amp;client = peer-&gt;get_peer();
        
            if(peer-&gt;session[&quot;userid&quot;].to_int()&gt;0)
            {
                 co_return &quot;ok&quot;;
            } 
        
            client &lt;&lt; &quot;You must login&quot;;
        
            co_return &quot;&quot;;
        }
        </code></pre>
        <p><code>asio::awaitable&lt;std::string&gt;</code> åç¨‹æ³¨è§£å‡½æ•°è¡¨ç¤ºé‡Œé¢ä»£ç ä¸èµ°ä¸šåŠ¡çº¿ç¨‹ï¼Œ
        å¦‚æœç¹é‡è®¡ç®—æœ€å¥½ä½¿ç”¨æ™®é€šå‡½æ•°ï¼Œè¿™æ ·èµ°ä¸šåŠ¡çº¿ç¨‹å¤„ç†ï¼Œä¸ä¼šå¡IOçº¿ç¨‹ã€‚</p>
        <p><code>peer-&gt;session[&quot;userid&quot;]</code> è¡¨ç¤ºå–å¾—<code>session</code>å†…å®¹ï¼Œå¯ä»¥åœ¨ç™»å½•æˆåŠŸåä¿å­˜è¿›å»ã€‚</p>
        <p><code>client &lt;&lt; &quot;You must login&quot;;</code> æ˜¯é‡è½½äº†<code>&lt;&lt;</code>è¿ç®—ç¬¦,çœŸå®å†…å®¹æ˜¯ä¿å­˜åœ¨<code>peer-&gt;output</code>ã€‚</p>
        <p><code>co_return &quot;&quot;;</code> æ˜¯åç¨‹è¿”å›ç»“æœï¼Œè¯·æ³¨æ„å’Œæ™®é€šå‡½æ•°åŒºåˆ«ï¼Œä¸çŸ¥é“æœ€å¥½è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚</p>
        <p>ä¸‹é¢æ˜¯æ™®é€šæ³¨å†Œå‡½æ•°,æ³¨æ„è¿”å›å€¼ï¼Œè¡¨ç¤ºèµ°ä¸šåŠ¡çº¿ç¨‹æ± ï¼Œå°±æ˜¯ä¸€ä¸ªè¿æ¥åˆ†é…ä¸€ä¸ªçº¿ç¨‹ï¼Œç»å…¸åº”ç”¨ã€‚</p>
        <p>å»ºè®®æœ‰è´Ÿè½½è®¡ç®—æœ€å¥½ä½¿ç”¨è¿™ç§æ™®é€šå‡½æ•°ï¼Œä¸ç„¶å¤§é‡è®¡ç®—å¯èƒ½å½±å“å¹¶å‘é‡ï¼Œæ˜¯æœ‰å¯èƒ½ï¼Œå¦‚æœåªæ˜¯CRUDä¸šåŠ¡
        ç”¨é‚£ç§æ–¹å¼åº”è¯¥é—®é¢˜ä¸å¤§ï¼Œç”¨åç¨‹å°±ä¸è¦ä½¿ç”¨ <code>std::this_thread::sleep_for(std::chrono::microseconds(1000));</code>
        è¿™ç§ä»£ç ã€‚</p>
        <pre><code class="language-C++">//@urlpath(null,hello)
        std::string testhello(std::shared_ptr&lt;httppeer&gt; peer)
        {
            httppeer &amp;client = peer-&gt;get_peer();
            client &lt;&lt; &quot; Hello world! ğŸ§¨ Paozhu c++ web framework &quot;;
        
            return &quot;&quot;;
        }
        
        </code></pre>
        <p>æ›´å¤šä»£ç ä½¿ç”¨æ¡ˆä¾‹è¯·å‚è€ƒ <code>controller/src</code> ç›®å½•ä¸‹çš„ä¾‹å­</p>
    </div>
    <div class="container">
        <h3>å†…ç½®å¾®å‹å¯¹è±¡ä»‹ç»</h3>
        <pre><code class="language-C++">http::obj_val hval;
        hval[&quot;aaa&quot;]=3344;
        hval[&quot;bbb&quot;]=&quot;1234567890&quot;;
        
        std::cout&lt;&lt;&quot;ll:&quot;&lt;&lt;hval[&quot;aaa&quot;].to_int()&lt;&lt;std::endl;
        std::cout&lt;&lt;&quot;vv:|&quot;&lt;&lt;static_cast&lt;int&gt;(hval[&quot;bbb&quot;].get_type())&lt;&lt;&quot;|&quot;&lt;&lt;std::endl;
        if(hval[&quot;bbb&quot;].is_string())
        {
            std::cout&lt;&lt;&quot;str:&quot;&lt;&lt;hval[&quot;bbb&quot;].to_string()&lt;&lt;std::endl;
            std::cout&lt;&lt;&quot;str:&quot;&lt;&lt;hval[&quot;bbb&quot;].str_view()&lt;&lt;std::endl;
            std::cout&lt;&lt;&quot;str:&quot;&lt;&lt;hval[&quot;bbb&quot;].str_view(2,5)&lt;&lt;std::endl;
        }
        
        http::obj_val nval;
        nval.from_json(&quot;{\&quot;bba\&quot;:[[[111,222],[333,444],[555,666]],[[777,888],[999,1111],[2222,3333]],[[4444,5555],[6666,7777],[8888,9999]]]}&quot;);
        
        std::cout&lt;&lt;&quot;json out:&quot;&lt;&lt;nval.to_json()&lt;&lt;std::endl;
        
        std::string bbb=nval.to_json();
        http::obj_val pval;
        pval.from_json(bbb);
        </code></pre>
        <p><code>http::obj_val</code> æ˜¯æ¡†æ¶å†…ç½®ä¸€ä¸ªå¾®å‹å¯¹è±¡ï¼Œå¯ä»¥å¯¼å…¥<code>from_json</code>å’Œå¯¼å‡º<code>to_json</code> <code>JSON</code>å¯¹è±¡è½¬æ¢ã€‚</p>
        <p>æ˜¯ä¸æ˜¯æœ‰è„šæœ¬è¯­è¨€å‘³é“ï¼Œå¯ä»¥ä¿å­˜æ•°å€¼å’Œå­—ç¬¦ä¸²ï¼Œè€Œä¸”å¯ä»¥ä¿å­˜æ ‘å½¢ç»“æ„ã€‚</p>
        <p>ä¸€ä¸ª<code>http::obj_val</code>æ˜¯16ä¸ªå­—èŠ‚å¤§å°ï¼Œå¦‚æœæ˜¯<code>KV</code>å¯¹è±¡è¦64å¤§å°ã€‚</p>
        <p><code>hval[&quot;aaa&quot;]</code> å°±æ˜¯<code>KV</code>å¯¹è±¡ã€‚</p>
        <p><code>http::obj_val</code> å¯¹è±¡å†…ç½®æ–¹æ³•</p>
        <ul>
        <li><code>set_array()</code> è®¾ç½®ä¸ºæ•°ç»„ å¯ä»¥ä½¿ç”¨push(v)</li>
        <li><code>set_obj()</code> è®¾ç½®ä¸ºå¯¹è±¡KV å¯ä»¥ä½¿ç”¨push(k,v)æˆ–obj[key]=valueæ–¹å¼</li>
        <li><code>set_object()</code> è®¾ç½®ä¸ºå¯¹è±¡KV å¯ä»¥ä½¿ç”¨push(k,v)æˆ–obj[key]=valueæ–¹å¼</li>
        </ul>
        <h4>åˆ¤æ–­å¯¹è±¡å±æ€§</h4>
        <ul>
        <li><code>is_array()</code> æ˜¯å¦æ˜¯æ•°ç»„</li>
        <li><code>is_obj()</code>	æ˜¯å¦æ˜¯å¯¹è±¡</li>
        <li><code>is_object()</code> æ˜¯å¦æ˜¯å¯¹è±¡</li>
        <li><code>is_string()</code> æ˜¯å¦æ˜¯å­—ç¬¦ä¸²</li>
        <li><code>is_number()</code> æ˜¯å¦æ•°å­—</li>
        </ul>
        <h4>å…¸å‹ä½¿ç”¨æ–¹å¼å’ŒHTMLæ¨¡æ¿ä½¿ç”¨</h4>
        <pre><code class="language-C++">        client.val[&quot;list&quot;].set_array();
                obj_val temp;
        
                for (unsigned int i = 0; i &lt; topicm.record.size(); i++)
                {
                    temp[&quot;id&quot;]       = topicm.record[i].topicid;
                    temp[&quot;parentid&quot;] = topicm.record[i].parentid;
                    temp[&quot;value&quot;]    = topicm.record[i].title;
                    client.val[&quot;list&quot;].push(temp);
                }
        </code></pre>
    </div>
    <div class="container">
        <h4>åœ¨HTMLæ¨¡æ¿ä¸­ä½¿ç”¨</h4>
        <pre><code class="language-HTML">&lt;%c for(auto &amp;a:obj[&quot;infos&quot;].as_array()){ %&gt;
        &lt;tr&gt;
          &lt;td&gt;&lt;%c echo&lt;&lt;a[&quot;userid&quot;].to_string(); %&gt;&lt;/td&gt;
          &lt;td&gt;&lt;%c echo&lt;&lt;a[&quot;nickname&quot;].to_string(); %&gt;&lt;/td&gt;
          &lt;td&gt;&lt;%c echo&lt;&lt;a[&quot;name&quot;].to_string(); %&gt;&lt;/td&gt;
          &lt;td&gt;&lt;%c if(a[&quot;isopen&quot;].to_int()==1){ %&gt;å¯ç”¨&lt;%c }else{ %&gt;å…³é—­&lt;%c } %&gt;&lt;/td&gt;
          &lt;td&gt;&lt;a href=&quot;/superadmin/edituser?userid=&lt;%c echo&lt;&lt;a[&quot;userid&quot;].to_string(); %&gt;&quot;&gt;ç¼–è¾‘&lt;/a&gt; | &lt;a href=&quot;/superadmin/deleteuser?userid=&lt;%c echo&lt;&lt;a[&quot;userid&quot;].to_string(); %&gt;&quot; onclick=&quot;return confirm('ç¡®å®šåˆ é™¤ï¼Ÿ');&quot;&gt;åˆ é™¤&lt;/a&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;%c } %&gt;
        </code></pre>
        <p>ä¸»è¦åº”ç”¨åœ¨å¤æ‚å¯¹è±¡äº¤æ¢ç¨‹åºï¼Œå¦‚æœä¸æ˜¯å¯ä»¥ä½¿ç”¨C++ å†…ç½®å¯¹è±¡æˆ–STLåº“æ–¹å¼ã€‚</p>
        <h3>ORMä»‹ç»</h3>
        <p>paozhuæ¡†æ¶å†…ç½®ORMå¯¹è±¡ï¼Œç›®å‰è‡ªå·±åˆ†æMySQLåè®®ï¼Œæ–¹ä¾¿å’ŒORMæ•´åˆï¼Œè€Œä¸”æ”¯æŒåç¨‹æ¨¡å¼ï¼Œè¿™ä¸ªå®˜æ–¹æ²¡æœ‰æ”¯æŒã€‚</p>
        <p>é…ç½®æ–‡ä»¶ä½ç½® <code>conf/orm.conf</code></p>
        <pre><code>[default]
        type=main
        host=127.0.0.1
        port=3306
        dbname=hello_world
        user=benchmarkdbuser
        password=benchmarkdbpass
        pretable=
        maxpool=5
        dbtype=mysql
        #ssl=ON
        
        type=second
        host=127.0.0.1
        port=3306
        dbname=hello_world
        user=benchmarkdbuser
        password=benchmarkdbpass
        pretable=
        maxpool=20
        dbtype=mysql
        #ssl=ON
        </code></pre>
    </div>
    <div class="container">
        <h3>ORM é…ç½®</h3>
        <p><code>type</code> ä¸ºç±»å‹ å°±æ˜¯ä¸»ä»åˆ†ç¦»ï¼Œä»¥åå¯ä»¥å¼€å‘ç¼“å­˜åŒæ­¥ï¼Œç›®å‰å…ˆä¸»ä»ã€‚host <code>127.0.0.1</code> å¡«æœ¬åœ°çš„åœ°å€ï¼ŒMySQLå¿…é¡»å¤§äºç­‰äº8ç‰ˆæœ¬ï¼Œå› ä¸ºMySQL9ä¸æ”¯æŒæ—§çš„è®¤è¯äº†ï¼Œ
        <code>pretable</code> æ˜¯è¡¨å‰ç¼€ï¼Œæœ‰æ—¶å€™åªæœ‰ä¸€ä¸ªæ•°æ®åº“æƒé™å¯ä»¥ä¸€ä¸ªæ•°æ®åº“æ”¾å¤šä¸ªä¸šåŠ¡ã€‚
        <code>dbtype</code> ç›®å‰æ”¯æŒMySQLã€‚
        <code>ssl</code> å¯ä»¥æ‰“å¼€ï¼Œç‰¹åˆ«æ˜¯è¿œç¨‹è¿æ¥æ—¶å€™ï¼Œå¯ç”¨åŠ å¯†è¿æ¥ã€‚æœ¬åœ°çš„ä¸ä¼šå¯ç”¨sslè¿æ¥ã€‚</p>
    </div>
    <div class="container">
        <h3>ORM ä½¿ç”¨å…¥é—¨</h3>
        <p>æ¡†æ¶ç›®å‰æ”¯æŒæ•°æ®åº“åˆ°æ–‡ä»¶æ–¹å¼ï¼Œè¿™æ ·ä¿®æ”¹æ•°æ®åº“å¯ä»¥é‡æ–°ç”ŸæˆORMæ–‡ä»¶ã€‚
        ç¼–è¯‘æˆåŠŸå</p>
        <pre><code># ./bin/paozhu_cli 
        
        paozhu_cli(1495,0x7ff85ac38fc0) malloc: nano zone abandoned due to inability to reserve vm space.
          model ï½œ view | viewtocpp | control   
         Welcome to use cli to manage your MVC filesã€‚
        (m)model (v)view (f)viewtocpp or (c)control , (j)son ,x or q to exit[input m|v|f|c|j|]:
        </code></pre>
        <p>è¾“å…¥ m é€‰æ‹©ç”ŸæˆORMæ¨¡å‹æ–‡ä»¶</p>
        <pre><code>
        paozhu_cli(1495,0x7ff85ac38fc0) malloc: nano zone abandoned due to inability to reserve vm space.
          model ï½œ view | viewtocpp | control   
         Welcome to use cli to manage your MVC filesã€‚
        (m)model (v)view (f)viewtocpp or (c)control , (j)son ,x or q to exit[input m|v|f|c|j|]:m   
         ğŸ„ current path: /Users/hzq/paozhu
         1 hello_world
         3 paozhu_docs
         5 cppcms
        select db index:
        </code></pre>
        <p>è¾“å…¥ 1 é€‰æ‹© hello_world æ•°æ®åº“ç”Ÿæˆæ–‡ä»¶ã€‚</p>
        <pre><code>paozhu_cli(1495,0x7ff85ac38fc0) malloc: nano zone abandoned due to inability to reserve vm space.
          model ï½œ view | viewtocpp | control   
         Welcome to use cli to manage your MVC filesã€‚
        (m)model (v)view (f)viewtocpp or (c)control , (j)son ,x or q to exit[input m|v|f|c|j|]:m
         ğŸ„ current path: /Users/hzq/paozhu
         1 hello_world
         3 paozhu_docs
         5 cppcms
        select db index:1
        show tables;
        create fortune table to models ğŸš—
         create table metainfo file: /Users/hzq/paozhu/orm/include/fortunebase.h
        create world table to models ğŸš—
         create table metainfo file: /Users/hzq/paozhu/orm/include/worldbase.h
        (m)model (v)view (f)viewtocpp or (c)control , (j)son ,x or q to exit[input m|v|f|c|j|]:x
        </code></pre>
        <p>è¾“å…¥ x é€€å‡º</p>
        <pre><code>å¯ä»¥çœ‹åˆ° /Users/hzq/paozhu/orm ç›®å½•ä¸‹ç”Ÿæˆæ–‡ä»¶
        orm
        â”œâ”€â”€ include
        â”‚   â”œâ”€â”€ fortune_mysql.h
        â”‚   â”œâ”€â”€ fortunebase.h
        â”‚   â”œâ”€â”€ world_mysql.h
        â”‚   â””â”€â”€ worldbase.h
        â”œâ”€â”€ orm.h
        â”‚
        models
        â”œâ”€â”€ Fortune.cpp
        â”œâ”€â”€ World.cpp
        â””â”€â”€ include
            â”œâ”€â”€ Fortune.h
            â””â”€â”€ World.h
        </code></pre>
        <p>ORMç›®å½•æ˜¯å®ä½“æ–‡ä»¶ï¼Œä¸¤ä¸ªæ–‡ä»¶ä¸€ä¸ªæ˜¯mysqlè¿æ¥å±‚mysqlç»“å°¾ï¼Œä¸€ä¸ªæ˜¯æ•°æ®è¡¨å®ä½“æ˜ å°„base.hç»“å°¾ã€‚
        æˆ‘ä»¬å…¶å®æ˜¯æ“ä½œmodelsç›®å½•ä¸‹ORMæ–‡ä»¶ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶ä¸€ä¸ªcppä¸€ä¸ªhæ–‡ä»¶ï¼Œè‡ªåŠ¨ç”Ÿæˆï¼Œ
        ä½†æ˜¯åªç”Ÿæˆä¸€æ¬¡ï¼Œæœ‰äº†ä¸ä¼šè¦†ç›–ï¼Œå› ä¸ºçœŸæ­£ä¸šåŠ¡ç³»ç»Ÿå¯ä»¥è‡ªå·±åŠ ä¸šåŠ¡ä»£ç åœ¨é‡Œé¢ã€‚</p>
        <p>æ¯”å¦‚
        auto myworld = orm::World();
        å°±æ˜¯ models ç›®å½•ä¸‹ World.h
        è¿™ä¸ªæ˜¯é»˜è®¤æ•°æ®åº“ï¼Œæ¯”å¦‚è‡ªå¸¦cmsæ¼”ç¤º
        auto users = orm::cms::Sysuser();</p>
        <p>ormæ˜¯å‘½åç©ºé—´ï¼Œä¸»è¦æ˜¯ç»™ORMç”¨
        cmsæ˜¯orm.confæ•°æ®åº“é…ç½®æ ‡ç­¾ï¼Œä¹Ÿæ˜¯ç”Ÿæˆçš„cmså‘½åç©ºé—´ï¼Œæ–¹ä¾¿éš”ç¦»å’Œè½¬æ¢æ•°æ®åº“ï¼Œå¦‚æœæ˜¯[default]å¯ä»¥çœç•¥defaut.</p>
        <h3>ORMè®¾è®¡åŸç†</h3>
        <p>ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡å‘¢ï¼Œå…¶å®ä¹Ÿæ˜¯paozhuæ¡†æ¶ç›®å‰æ¯”å…¶å®ƒæ¡†æ¶éå¸¸æœ‰ç‰¹è‰²çš„è®¾è®¡ã€‚</p>
        <ol>
        <li>ä¸€ä¸ªæ•°æ®åº“å¯ä»¥æœ‰å¤šä¸ªè¿æ¥ï¼Œè¿™æ ·æˆ‘ä»¬ä¸ç”¨çŸ¥é“ä½¿ç”¨é‚£ä¸ªè¿æ¥ã€‚</li>
        <li>æ•°æ®åº“åå­—å¯èƒ½å¾ˆé•¿ï¼Œåƒäº‘ä¸»æœºå¯èƒ½è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå‡ åä¸ªå­—ç¬¦é•¿çš„æ•°æ®åº“åï¼Œç”šè‡³æœ‰ä¸‹åˆ’çº¿çš„ã€‚</li>
        <li>å¯ä»¥ä¸ªæ€§æ ‡ç­¾ï¼Œè¿™æ ·æ•°æ®åº“æ˜¯ä»€ä¹ˆåä¸é‡è¦äº†ã€‚</li>
        <li>æˆ‘ä»¬ç”¨æ¥åšå‘½åç©ºé—´éš”ç¦»è¡¨å¯¹è±¡ï¼Œè¿™æ ·å¾ˆå¤šæ•°æ®åº“ç”Ÿæˆçš„C++ç±»ä¸ä¼šå†²çªã€‚</li>
        </ol>
        <p>æ‰€ä»¥<code>orm::cms::Sysuser();</code>ä½¿ç”¨cmséš”ç¦»äº†<code>sysuser</code>è¡¨å®ä½“C++ç±»ï¼Œä¸ä¼šä¸å…¶å®ƒæ•°æ®åº“åŒåè¡¨æœ‰å†²çªã€‚
        æ¯”å¦‚<code>orm::erp::Sysuser();</code> erpæ˜¯erpæ•°æ®åº“æ ‡ç­¾ï¼Œä»–çš„æ•°æ®åº“æ˜¯ä»€ä¹ˆåä¸é‡è¦ï¼Œ
        å°±æ˜¯åŒæ ·æœ‰<code>sysuser</code>è¡¨ä¹Ÿæ²¡æœ‰å…³ç³»ã€‚</p>
        <p>ä¹‹æ‰€ä»¥è¿™æ ·è®¾è®¡ï¼Œå°±æ˜¯ä¸€ä¸ªä¸šåŠ¡ç³»ç»Ÿï¼Œä¸€ä¸ªå•ä½“æœåŠ¡å™¨ç¨‹åºï¼Œå¯ä»¥æœ‰å¾ˆå¤šæ•°æ®åº“ï¼Œè€Œä¸”ä»–ä»¬è¡¨åå¯ä»¥æœ‰é‡åã€‚
        ä»¥åå¯ä»¥æœ‰ä¸åŒæ•°æ®åº“ï¼Œæ¯”å¦‚MySQL PGç­‰ï¼Œä»–ä»¬å¯ä»¥åˆ†å¸ƒåœ¨å…¶å®ƒæœºå™¨ä¸Šã€‚
        ä»–ä»¬å¯ä»¥æ··åˆé›†ç¾¤ï¼Œå•ä½“æœåŠ¡å™¨ç¨‹åºä¹Ÿå¯ä»¥é›†ç¾¤ï¼Œå› ä¸ºå†…ç½®äº†è¯»å†™åˆ†ç¦»ï¼Œå†™æœåŠ¡å™¨å¯ä»¥åŒä¸€ä¸ªï¼Œ
        æŸ¥è¯¢å¯ä»¥å›ºå®šæˆ–åŠ¨æ€åˆ†é…æ•°æ®åº“æœåŠ¡å™¨,æ¡†æ¶å¯ä»¥é€‚åˆå¤§ä¸šåŠ¡ç³»ç»Ÿã€‚
        ç›®å‰çœ‹ä¸€ä¸ªæœåŠ¡å™¨é›†æˆæ•°æ®åº“å’Œä¸šåŠ¡ç¨‹åºä¸ºä¸»ã€‚</p>
    </div>
    <div class="container">
        <h3>ORMä½¿ç”¨ä¾‹å­</h3>
        <h4>åç¨‹æ–¹å¼ä½¿ç”¨ORM</h4>
        <pre><code class="language-C++">//@urlpath(null,queries)
        asio::awaitable&lt;std::string&gt; techempowerqueries(std::shared_ptr&lt;httppeer&gt; peer)
        {
            peer-&gt;type(&quot;application/json; charset=UTF-8&quot;);
            peer-&gt;set_header(&quot;Date&quot;, get_gmttime());
        
            unsigned int get_num = peer-&gt;get[&quot;queries&quot;].to_int();
            if (get_num == 0)
            {
                get_num = 1;
            }
            else if (get_num &gt; 500)
            {
                get_num = 500;
            }
            auto myworld = orm::World();
            myworld.record.reserve(get_num);
            myworld.lock_conn();
            for (unsigned int i = 0; i &lt; get_num; i++)
            {
                myworld.wheresql.clear();
                unsigned int rd_num = rand_range(1, 10000);
                myworld.where(&quot;id&quot;, rd_num);
                co_await myworld.async_fetch_append();
            }
            myworld.unlock_conn();
            peer-&gt;output = myworld.to_json();
            co_return &quot;&quot;;
        }
        </code></pre>
        <ul>
        <li><code>orm::World();</code> æ˜¯ORMçš„è¡¨æ¨¡å‹ï¼Œé»˜è®¤è¿æ¥ï¼Œæ‰€ä»¥ä¸ç”¨default</li>
        <li><code>myworld.lock_conn();</code> å°±æ˜¯å›ºå®šä¸€ä¸ªè¿æ¥ï¼Œå› ä¸ºä½¿ç”¨ORMè¿æ¥æ± æ–¹å¼,ä¼šè½®è®­ä½¿ç”¨è¿æ¥ã€‚</li>
        <li><code>myworld.record.reserve(get_num);</code> æ‰©å®¹è¿™ä¸ªç†Ÿæ‚‰STLçš„çŸ¥é“ã€‚</li>
        <li><code>myworld.wheresql.clear();</code> æ¨èä½¿<code>myworld.clearWhere();</code>æ–¹å¼æ¸…é™¤æ¡ä»¶ã€‚</li>
        <li><code>myworld.where(&quot;id&quot;, rd_num);</code> åŠ ä¸€ä¸ªæ¡ä»¶ã€‚</li>
        <li><code>co_await myworld.async_fetch_append();</code> æ˜¯é«˜çº§ç”¨æ³•ï¼Œä¼šé™„åŠ æ•°æ®åˆ°recordå¯¹è±¡ä¸Šã€‚ä¸€èˆ¬ä½¿ç”¨<code>co_await myworld.async_fetch();</code> ä¼šæ¸…é™¤recordå¯¹è±¡ï¼Œç„¶åé‡æ–°èµ‹å€¼ã€‚</li>
        </ul>
        <p><code>peer-&gt;output = myworld.to_json();</code> ç›´æ¥è¾“å‡ºJSONåˆ°æµè§ˆå™¨ã€‚</p>
        <p>è¡¨æ¨¡å‹æœ‰ä¸¤ä¸ªæˆå‘˜å˜é‡å¾ˆé‡è¦</p>
        <ul>
        <li>data     æ˜¯å•ä¸ªè¡¨æ•°æ®ç»“æ„æ˜ å°„</li>
        <li>record   ä¸€ä¸ªstd::vectoræ•°ç»„</li>
        </ul>
        <p>è¡¨æ•°æ®ç»“æ„</p>
        <pre><code class="language-C++">struct meta{
         unsigned  int  id = 0; 
         int  randomnumber = 0;  
        } data;
        
        std::vector&lt;worldbase::meta&gt; record;
        </code></pre>
    </div>
    <div class="container">
        <h4>åŒæ­¥ä½¿ç”¨ORM</h4>
        <p>æ­£å¸¸ä¸šåŠ¡ä»£ç åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è¿è¡Œï¼Œå°±æ˜¯ä¸€ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸ªå¾ˆç»å…¸æ–¹å¼ã€‚</p>
        <pre><code class="language-C++">//@urlpath(admin_islogin,admin/addtopic)
        std::string admin_addtopic(std::shared_ptr&lt;httppeer&gt; peer)
        {
            httppeer &amp;client = peer-&gt;get_peer();
            try
            {
                auto topicm = orm::cms::Topic();
                topicm.where(&quot;userid&quot;, client.session[&quot;userid&quot;].to_int()).asc(&quot;parentid&quot;).fetch();
        
                client.val[&quot;list&quot;].set_array();
                obj_val temp;
        
                for (unsigned int i = 0; i &lt; topicm.record.size(); i++)
                {
                    temp[&quot;id&quot;]       = topicm.record[i].topicid;
                    temp[&quot;parentid&quot;] = topicm.record[i].parentid;
                    temp[&quot;value&quot;]    = topicm.record[i].title;
                    client.val[&quot;list&quot;].push(temp);
                }
            }
            catch (std::exception &amp;e)
            {
                client.val[&quot;code&quot;] = 1;
            }
        
            peer-&gt;view(&quot;admin/addtopic&quot;);
            return &quot;&quot;;
        }
        </code></pre>
      </div>
      <div class="container">

        <h3>C++ç”Ÿäº§ç¯å¢ƒæ•…éšœæ’æŸ¥</h3>
        <p>éœ€è¦å®‰è£…gdb coredumpctl</p>
        <p>æ¡†æ¶ä¼šéš”1åˆ†é’Ÿå·¦å³æ£€æŸ¥ <code>log</code> ç›®å½•æ˜¯å¦æœ‰<code>restart_server</code>æ–‡ä»¶</p>
        <p>å¦‚æœæˆ‘ä»¬éœ€è¦å–ç°åœ¨çº¿ç¨‹æ ˆæ ·å“ï¼Œå¯ä»¥ <code>touch log/restart_server</code> è¿™æ ·å¯ä»¥è®©è¿›ç¨‹é‡å¯</p>
        <p>å¯ä»¥ä½¿ç”¨<code>pstree -aup</code> æŸ¥çœ‹è¿›ç¨‹æƒ…å†µ</p>
        <p>å¦‚æœå·²ç»å–æ ·ï¼Œéœ€è¦åˆ†æè¿›ç¨‹æ ˆæƒ…å†µ</p>
        <p>æ ¸å¿ƒcoredumpæŸ¥çœ‹</p>
        <pre><code>coredumpctl list
        coredumpctl info
        </code></pre>
        <p>ç›´æ¥åœ¨çº¿çœ‹,1524æ˜¯ info æ˜¾ç¤ºçš„è¿›ç¨‹å·ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰<code>pstree -aup</code> çœ‹çš„</p>
        <pre><code>coredumpctl gdb 1524
        </code></pre>
        <p>btå¯ä»¥æŸ¥çœ‹</p>
        <p>è¿›å»åæˆ‘ä»¬å¯ä»¥ä¿å­˜å‡ºæ¥çœ‹ï¼Œä¿å­˜åœ¨å½“å‰ç›®å‰ <code>thread_info.txt</code>æ–‡ä»¶ã€‚</p>
        <pre><code>set logging file thread_info.txt
        set logging enabled on
        thread apply all bt
        set logging enabled off
        </code></pre>
        <p>æ ¸å¿ƒcoredumpä¸€èˆ¬åœ¨</p>
        <pre><code>/var/lib/systemd/coredump
        </code></pre>

        <p>å¦‚æœç¼–è¯‘ä½¿ç”¨-g é‚£ä¹ˆä¼šçœ‹åˆ°ç±»ä¼¼ä¸‹é¢æ ·å­ï¼Œä¸€èˆ¬ä¼šæ˜¾ç¤ºå„ç§çº¿ç¨‹ç›®å‰æ­£åœ¨å¹²ä»€ä¹ˆäº‹</p>

        <pre><code>Thread 17 (Thread 0x7fd9f16b9640 (LWP 10658)):
          #0  http::hash_objkey (key=&quot;data:image/php;base64,PD9waHAgJE8wME9PMD11cmxkZWNvZGUoIiU3OCUzNCU2My&quot;...) at /www/paozhu/vendor/httpserver/src/request.cpp:54
          #1  0x000000000060032f in http::OBJ_VALUE::operator[] (this=0x7fd9cc01e520, key=&quot;data:image/php;base64,PD9waHAgJE8wME9PMD11cmxkZWNvZGUoIiU3OCUzNCU2MyU2RiUyRiU3MCUzOSU3OSU3MSU2RSU2NCUyRCU2QyU3MiU2QiU2NCU2NyU1RiU&quot;...) at /www/paozhu/vendor/httpserver/src/request.cpp:315
          #2  0x00000000005a990c in http::httpparse::procssxformurlencoded (this=0x7fd9b400d370) at /www/paozhu/vendor/httpserver/src/http_parse.cpp:389
          #3  0x00000000005b1bfa in http::httpparse::process (this=0x7fd9b400d370, buffer=0x2e223c0 &quot;POST /public/static/lib/webuploader/0.1.5/server/preview.php HTTP/1.1\r\nHost: www. paozhu.org\r\nUser-Agent: Mozilla/5.0 AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0\r\nAccept-Encoding: gzip, deflate&quot;..., buffersize=964) at /www/paozhu/vendor/httpserver/src/http_parse.cpp:2823
          </code></pre>
    </div>
</body>

</html>