<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PaoZhu C++ Web Frameworks</title>
    <style>
        /* Light mode */
        body {
            font-family:'PingFang SC','Helvetica Neue','Microsoft YaHei UI','Microsoft YaHei','Noto Sans CJK SC',Sathu,EucrosiaUPC,Arial,Helvetica,sans-serif;
            font-size:16px;
            line-height:1.45em;
        }
        code{
            background-color: #EEE;
            border-radius: 5px;
            padding: 3px;
        }
        @media (prefers-color-scheme: light) {
        body {
            color: black;
            background-color: white;
            font-size: 14px;
        }
        body pre {
            padding: 5px;
            overflow: auto;
            line-height: 1.45em;
            background-color: #EEE;
            border-radius: 6px;
        }
 
        body pre {
            word-wrap: normal;
        }
        body pre > code {
            padding: 0;
            margin: 0;
            word-break: normal;
            white-space: pre;
            background: transparent;
            border: 0;
        }
 
        body pre > code {
            white-space: pre-wrap;
        }
        code{
            background-color: #EEE;
            border-radius: 5px;
            padding: 3px;
        }

        }

        /* Dark mode */
        @media (prefers-color-scheme: dark) {
        body {
            color: white;
            background-color: black;
        }

        body pre {
            padding: 5px;
            overflow: auto;
            line-height: 1.45em;
            background-color: #333;
            border-radius: 6px;
        }
 
        body pre {
            word-wrap: normal;
        }
        body pre > code {
            padding: 0;
            margin: 0;
            word-break: normal;
            white-space: pre;
            background: transparent;
            border: 0;
        }
 
        body pre > code {
            white-space: pre-wrap;
        }

        code{
            background-color: #333;
            border-radius: 5px;
            padding: 3px;
        }
        }

        @media (min-width: 1200px) {
            .container {
                width: 1080px;
                margin: 0 auto;
            }
        }
    </style>

</head>

<body>
    <h1 style="text-align:center;">PaoZhu C++ Web Frameworks</h1>
    <h4 style="text-align:center;"><a href="documentation.html">‰∏≠Êñá</a> <a href="documentation_en.html">English</a></h4>
    <div class="container">
        <h3>Catalogue</h3>
        <ul>
            <li><a href="#Abstract">Abstract</a></li>
            <li><a href="#Install">Paozhu Install</a></li>
            <li><a href="#Config">Paozhu Config</a></li>
            <li><a href="#Helloworld">Hello World</a></li>
            <li><a href="#objval">Introduction to Built in Micro Objects(JSON)</a></li>
            <li><a href="#ormcontent">ORM Introduction</a></li>
            <li><a href="#Htmltemplate">HTML Template View Description</a></li>
            <li><a href="#jsonencode">JSON and struct conversion function json_encode json_decode</a></li>
            <li><a href="#Troubleshooting">Troubleshooting in C++ Production Environment</a></li>
        </ul>
    </div>
    <div class="container">
        <h3 id="Abstract"><strong>Abstract</strong></h3>
        <p>Paozhu is a C++ Web development framework with built-in HTTP/1/HTTP/2 ORM, making it easy and elegant to write web programs, breaking the previous inconvenience of writing web programs in C++.</p>
        <p>Paozhu has developed the underlying infrastructure for web development, such as multi domain binding, SSL certificate management, cookies, sessions, HTML form management, URL processing, file upload and download, HttpClient, ORM, WebSocket, Logs, HTML Template, covering the basics of web development.</p>
        <p>The framework is based on C++20, using new standards with complete compiler support, and modernizing the code. The framework has enabled ASAN and all error prompts(-Wall), making it easy to identify problems during the development phase. It can also be combined with the coredumpctl tool at runtime to view the memory stacks of various programs. Combined with intelligent pointers, the framework has basically eliminated memory leaks and out of bounds issues, and has not encountered any memory leaks or crashes so far.</p>
        <p>Paozhu uses C++ mainly to consider the integration of large models (CUDA, file storage, network, memory operations), compared to GO JAVA RUST, which are not very perfect. C++ is also not perfect, RUST syntax is not good-looking, GO is simple but lacks AI culture in Big models, etc. At present, the experience is that ASAN and coredumpctl tools can also ensure the quality of C++, and the new compiler can also provide some hints.</p>
        <h3>paozhu Feature</h3>
        <ol>
        <li>Supports HTTP2.</li>
        <li>Built in ORM (self-developed MySQL protocol), supporting coroutine mode.</li>
        <li>Multi domain management and SAAS mode support.</li>
        <li>Separate IO threads from business threads.</li>
        <li>Built in micro objects, JSON import and export, similar to variables in scripting languages.</li>
        <li>Built in FastCGI supports PHP</li>
        </ol>
        <h3>paozhu Framework technology architecture principle</h3>
        <p>The Paozhu framework uses ASIO's thread pool, which is specifically designed for IO usage, such as network sending and receiving. The framework also has a built-in business thread pool, which is dedicated to running business code.</p>
        <p>At present, the frameworks mainly use HTTP and HTTPS, with two threads constantly listening for connections to arrive. When a user accesses using a browser or client, a connection is generated, and after handshake, the server waits for the client to send HTTP header information. Then, the server processes the HTTP protocol. If the URL matches, it registers a function and checks whether the function is a coroutine or a regular function. The coroutine runs directly. If it is a regular function, it is thrown directly into the business thread pool. If the URL is a static file, it is sent directly without going through the business thread.</p>
        <p>Because C++coroutines are contagious, when running business code in coroutine registration functions, you need to use ORM coroutine methods. If you cannot initiate coroutine functions in regular functions, you can only use ORM regular functions.</p>
        <p>It is generally recommended to use one connection to one thread, and business threads also have queues, so business code should not use the sleep function to sleep casually.</p>
        <h3>paozhu Environment</h3>
        <p>Paozhu supports <code>MacOS</code> <code>Linux</code> and <code>Windows</code> systems.</p>
        <p>Uses third-party dependencies</p>
        <p><code>OpenSSL</code> <code>Zlib</code> <code>Brotli</code> <code>ASIO</code></p>
        <p>Optional third-party dependencies</p>
        <p><code>GD</code> <code>qrencode</code></p>
        <p>The framework is based on C++20 or above, ensuring that your system supports compilers that support C++20.</p>
        <ul>
        <li><code>MacOS</code> <code>MacOS 11 BigSur</code> above,suggestion <code>MacOS 14 Sonoma</code></li>
        <li><code>Ubuntu</code> 22.04 above</li>
        <li><code>RockyLinux</code> <code>AlmaLinux</code> 9.1 above</li>
        <li><code>Windows</code> Win10 Compiler 19.25 or above„ÄÇ</li>
        </ul>
        <h3 id="Install">Paozhu install</h3>
        <p>Download <a href="https://github.com/hggq/paozhu" target="_blank">https://github.com/hggq/paozhu</a></p>
        <ul>
        <li><a href="https://hggq.github.io/paozhudocs/macos_en.html" target="_blank">MacOS install</a></li>
        <li><a href="https://hggq.github.io/paozhudocs/ubuntu_en.html" target="_blank">Ubuntu install</a></li>
        <li><a href="https://hggq.github.io/paozhudocs/linux_en.html" target="_blank">RockyLinux AlmaLinux install</a></li>
        <li><a href="https://hggq.github.io/paozhudocs/windows_en.html" target="_blank">Windows install</a></li>
        </ul>
        <h3 id="Config">paozhu Config</h3>
        <p>paozhu Config file at <code>conf/server.conf</code></p>
        <p>You can first understand a few variables to get the project running.</p>
        <pre><code>[default]
        threadmax=1024
        threadmin=5
        httpport=80
        httpsport=443
        cothreadnum=8 ;Coroutines run on thread num
        
        http2_enable=1
        debug_enable=1
        deamon_enable=0
        mainhost=www.869869.com
        certificate_chain_file=www.869869.com.pem
        private_key_file=www.869869.com.key
        tmp_dh_file=dh4096.pem
        reboot_password=e10adc3949ba59abbe56e057f20f883e ;md5(md5(&quot;123456&quot;)+&quot;rand_char&quot;+md5(&quot;123456&quot;))
        reboot_cron =d180h5 ;MDSW+Hhours reboot process M month D day S season (1 4 7 10) W week  
        clean_cron  =m5t600 ;5-minute interval clean 600 seconds ago inactive connection
        links_restart_process =n9998877ts1te5 ;More than 15000 connections, restart the process from 1:00 am to 5:00 am
        session_type=1 ;session save type 0.file 1.memory 2.redis 3.memcache 4.reserve
        static_file_compress_cache=1 ;1 enable, Cache static file compress(gzip,br) content to cache directory 
        modelspath=/Users/hzq/paozhu/models
        serverpath=/Users/hzq/paozhu
        viewpath=/Users/hzq/paozhu/view
        viewsopath=/Users/hzq/paozhu/module/view
        
        controlpath=/Users/hzq/paozhu/controller
        controlsopath=/Users/hzq/paozhu/module/controller
        
        temppath=/Users/hzq/paozhu/temp
        logpath=/Users/hzq/paozhu/log
        wwwpath=/Users/hzq/paozhu/www/default
        pluginspath=/Users/hzq/paozhu/plugins
        libspath=/Users/hzq/paozhu/libs
        directorylist=1
        index=index.html
        ;usehtmlcache=1
        ;usehtmlcachetime=3600
        staticfile_cache_num=0 ;0 not cache, min 10 begin  
        rewrite_404=0   ;1 file 2 action url path
        rewrite_404_action=index.html
        method_pre=
        method_after=
        show_visitinfo=0
        upload_max_size=16777216
        siteid=1
        groupid=0
        alias_domain=
        init_func=
        [www.869869.com]
        wwwpath=/Users/hzq/paozhu/www/default
        http2_enable=1
        ;rewrite_404=1
        ;rewrite_404_action=index.html|psy/index.html|exam/index.html
        ;controlsopath=/Users/hzq/paozhu/docs/controller
        static_pre=downloadfileauth|upload
        method_pre= ;api/dev/hostcors
        method_after=
        isuse_php=0
        rewrite_php=/Users/hzq/www/mpdftest|index.php
        fastcgi_host=127.0.0.1 ;/run/php/php8.1-fpm.sock
        fastcgi_port=9000
        upload_max_size=16777216
        siteid=1
        groupid=0
        alias_domain=
        init_func=
        </code></pre>
        <pre><code>threadmax=1024  Maximum number of business threads
        threadmin=5		 Minimum number of business threads
        httpport=80	    Server listening port
        httpsport=443   SSL server listening port
        cothreadnum=8 ;Coroutines run on thread num 
        </code></pre>
        <p><code>http2_enable=1</code> Whether to enable HTTP/2, each domain can have its own settings</p>
        <p>SSL certificate file, after successful application, it should be placed in the conf directory. For production environments, a copy should be placed in <code>/var/local/etc/paozhu</code>.</p>
        <pre><code>mainhost=www.869869.com
        certificate_chain_file=www.869869.com.pem
        private_key_file=www.869869.com.key
        </code></pre>
        <p><code>reboot_cron</code> Automatic restart process cycle day D week W month M season S h time hour 180 days 5 am restart process
        <code>links_restart_process</code> If the number of connections is reached, you can also restart the number of connections after n, The ts start period and te end period will restart if they are idle during this period.</p>
        <pre><code>reboot_cron =d180h5 ;MDSW+Hhours reboot process M month D day S season (1 4 7 10) W week  
        clean_cron  =m5t600 ;5-minute interval clean 600 seconds ago inactive connection
        links_restart_process =n9998877ts1te5 ;More than 15000 connections, restart the process from 1:00 am to 5:00 am
        </code></pre>
        <p><code>directorylist=1</code> Display directory. If the requested static file is a directory name and there is no index.html file in the directory, a directory list will be displayed.
        It is recommended to set the production environment to 0</p>
        <p><code>wwwpath=/Users/hzq/paozhu/www/default</code> <code>/Users/hzq/paozhu</code> Suggest changing to your current directory name, Under the project, 'www/default' is a static file directory. If it is a multi domain, it is recommended to create a 'www/domain.com' setting for SAAS services.</p>
        <p><code>upload_max_size=16777216</code> Upload file size, default is 16M</p>
        <p>The following are SAAS settings that can be ignored for now</p>
        <pre><code>siteid=1
        groupid=0
        alias_domain=
        init_func=
        </code></pre>
        <p>Beginners only need to understand <code>httpport</code> <code>httpsport</code> <code>wwwpath</code> <code>logpath</code> Ensure that the settings are correct, Replace all '/Users/hzq/paozhu' with your directory.</p>
        <h3 id="Helloworld">paozhu Introduction</h3>
        <h4>Hello World Example</h4>
        <pre><code class="language-C++">
        #include "techempower.h"       
        //@urlpath(null,plaintext)
        asio::awaitable&lt;std::string&gt; techempowerplaintext(std::shared_ptr&lt;httppeer&gt; peer)
        {
            peer-&gt;type(&quot;text/plain; charset=UTF-8&quot;);
            peer-&gt;set_header(&quot;Date&quot;, get_gmttime());
            peer-&gt;output = &quot;Hello, World!&quot;;
            co_return &quot;&quot;;
        }
        
        </code></pre>
        <h3>Annotation Fundamentals</h3>
        <p>All annotation functions must be placed in the 'controller/src' directory</p>
        <p>This <code>techempower.cpp</code> file must contain its own file name <code>#include "techempower.h"</code>, The <code>techempower.h</code> file will be automatically generated.</p>
        <p>When compiling, use the CMake Hook to first compile an annotation handler that can be used, and then execute this program to handle <code>controller/src</code> Extract functions in the format of '//@ urlpath(null, plaintext)' from all files in the directory, create corresponding header files, and then generate Annotate the function and save the mapping function to the 'common/autocontrolmethod.hpp' file.</p>
        <p>Doesn't it have a strong Java Spring Boot flavor, so that we can elegantly write URL and function mapping relationships after all.</p>
        <h3>Annotation Example</h3>
        <p><code>//@urlpath(null,plaintext)</code> annotate functionsÔºåMapping with URLÔºåExample http://localhost/plaintext Will access the annotation function of 'plaintext'.</p>
        <p>null represents the annotation function that must be executed before accessing plaintext, for example: a backend with permissions that requires verification of login status</p>
        <p><code>//@urlpath(islogin,plaintext)</code> This requires first executing the 'islogin' annotation and returning 'OK' to indicate success.</p>
        <pre><code class="language-C++">//@urlpath(null, islogin)
        asio::awaitable&lt;std::string&gt; checklogin(std::shared_ptr&lt;httppeer&gt; peer)
        {
            httppeer &amp;client = peer-&gt;get_peer();
        
            if(peer-&gt;session[&quot;userid&quot;].to_int()&gt;0)
            {
                 co_return &quot;ok&quot;;
            } 
        
            client &lt;&lt; &quot;You must login&quot;;
        
            co_return &quot;&quot;;
        }
        </code></pre>
        <p><code>asio::awaitable&lt;std::string&gt;</code> The coroutine annotation function indicates that the code inside does not go through business threads, If heavy calculations are required, it is best to use regular functions so that business threads can handle them without blocking IO threads.</p>
        <p><code>peer-&gt;session[&quot;userid&quot;]</code> get <code>session</code> content, The content saved after successful login before„ÄÇ</p>
        <p><code>client &lt;&lt; &quot;You must login&quot;;</code> It is overloaded with the&lt;&lt;operator, and the actual content is saved in peer-&gt;output.</p>
        <p><code>co_return &quot;&quot;;</code> It is a coroutine that returns the result. Please note that it is different from a regular function, and it is best to return an empty string if you are unsure.</p>
        <p>The following is a regular registration function, pay attention to the return value, indicating that it goes through the business thread pool, which assigns one thread to each connection. This is a classic application.</p>
        <p>It is recommended to use this ordinary function for load computing, otherwise a large amount of computation may affect concurrency, which is possible if it is only for CRUD business
        It shouldn't be a problem to use that method. When using coroutines, don't use std:: this_thread::sleep_for(std::chrono::microseconds(1000));`
        This type of code.</p>
        <pre><code class="language-C++">//@urlpath(null,hello)
        std::string testhello(std::shared_ptr&lt;httppeer&gt; peer)
        {
            httppeer &amp;client = peer-&gt;get_peer();
            client &lt;&lt; &quot; Hello world! üß® Paozhu c++ web framework &quot;;
        
            return &quot;&quot;;
        }
        
        </code></pre>
        <p>For more code usage cases, please refer to the examples in the 'controller/src' directory</p>
    </div>
    <div class="container"> 
        <h3 id="objval">Introduction to Built in Micro Objects</h3>
        <pre><code class="language-C++">http::obj_val hval;
        hval[&quot;aaa&quot;]=3344;
        hval[&quot;bbb&quot;]=&quot;1234567890&quot;;
        
        std::cout&lt;&lt;&quot;ll:&quot;&lt;&lt;hval[&quot;aaa&quot;].to_int()&lt;&lt;std::endl;
        std::cout&lt;&lt;&quot;vv:|&quot;&lt;&lt;static_cast&lt;int&gt;(hval[&quot;bbb&quot;].get_type())&lt;&lt;&quot;|&quot;&lt;&lt;std::endl;
        if(hval[&quot;bbb&quot;].is_string())
        {
            std::cout&lt;&lt;&quot;str:&quot;&lt;&lt;hval[&quot;bbb&quot;].to_string()&lt;&lt;std::endl;
            std::cout&lt;&lt;&quot;str:&quot;&lt;&lt;hval[&quot;bbb&quot;].str_view()&lt;&lt;std::endl;
            std::cout&lt;&lt;&quot;str:&quot;&lt;&lt;hval[&quot;bbb&quot;].str_view(2,5)&lt;&lt;std::endl;
        }
        
        http::obj_val nval;
        nval.from_json(&quot;{\&quot;bba\&quot;:[[[111,222],[333,444],[555,666]],[[777,888],[999,1111],[2222,3333]],[[4444,5555],[6666,7777],[8888,9999]]]}&quot;);
        
        std::cout&lt;&lt;&quot;json out:&quot;&lt;&lt;nval.to_json()&lt;&lt;std::endl;
        
        std::string bbb=nval.to_json();
        http::obj_val pval;
        pval.from_json(bbb);
        </code></pre>
        <p><code>http::obj_val</code> is a built-in micro object in the framework that can be used to import and export <code>from_json</code> and <code>to_json</code> object conversions.</p>
        <p>Does it have a scripting language flavor? It can save values and strings, and can also save tree structures.</p>
        <p><code>http::obj_val</code> is 16bytes sizeÔºåone <code>KV</code> Object 64bytes size„ÄÇ</p>
        <p><code>hval[&quot;aaa&quot;]</code> is <code>KV</code> Object„ÄÇ</p>
        <p><code>http::obj_val</code> Built in methods for objects</p>
        <ul>
        <li><code>set_array()</code> set is array and push(v)</li>
        <li><code>set_obj()</code> set is KV and usempush(k,v) or obj[key]=value</li>
        <li><code>set_object()</code> set is KV and usempush(k,v) or obj[key]=value</li>
        </ul>
        <h4>More methods</h4>
        <ul>
        <li><code>is_array()</code> it is an array or not</li>
        <li><code>is_obj()</code>   it is an object or not</li>
        <li><code>is_object()</code> it is an object or not</li>
        <li><code>is_string()</code> it is an string or not</li>
        <li><code>is_number()</code> it is an number or not</li>
        </ul>
        <h4>Typical usage and HTML template usage</h4>
        <pre><code class="language-C++">        client.val[&quot;list&quot;].set_array();
                obj_val temp;
        
                for (unsigned int i = 0; i &lt; topicm.record.size(); i++)
                {
                    temp[&quot;id&quot;]       = topicm.record[i].topicid;
                    temp[&quot;parentid&quot;] = topicm.record[i].parentid;
                    temp[&quot;value&quot;]    = topicm.record[i].title;
                    client.val[&quot;list&quot;].push(temp);
                }
        </code></pre>
        <h4>Using in HTML templates</h4>
        <pre><code class="language-HTML">&lt;%c for(auto &amp;a:obj[&quot;infos&quot;].as_array()){ %&gt;
        &lt;tr&gt;
          &lt;td&gt;&lt;%c echo&lt;&lt;a[&quot;userid&quot;].to_string(); %&gt;&lt;/td&gt;
          &lt;td&gt;&lt;%c echo&lt;&lt;a[&quot;nickname&quot;].to_string(); %&gt;&lt;/td&gt;
          &lt;td&gt;&lt;%c echo&lt;&lt;a[&quot;name&quot;].to_string(); %&gt;&lt;/td&gt;
          &lt;td&gt;&lt;%c if(a[&quot;isopen&quot;].to_int()==1){ %&gt;Open&lt;%c }else{ %&gt;Close&lt;%c } %&gt;&lt;/td&gt;
          &lt;td&gt;&lt;a href=&quot;/superadmin/edituser?userid=&lt;%c echo&lt;&lt;a[&quot;userid&quot;].to_string(); %&gt;&quot;&gt;Edit&lt;/a&gt; | &lt;a href=&quot;/superadmin/deleteuser?userid=&lt;%c echo&lt;&lt;a[&quot;userid&quot;].to_string(); %&gt;&quot; onclick=&quot;return confirm('Are you sure deleteÔºü');&quot;&gt;Delete&lt;/a&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;%c } %&gt;
        </code></pre>
        <h4>Micro Objects advanced methods</h4>
        <ul>
        <li><code>obj_val multi_sort(std::string_view key,unsigned char order);</code> 2D array key name sorting, order is SORT_ASC or SORT_DESC.</li>
        <li><code>obj_val multi_sort(std::string_view key,unsigned char order,std::string_view key2,unsigned char order2);</code>	2D array key name sorting, order is SORT_ASC or SORT_DESC, If there is the same secondary sorting,need key2 and order2.</li>
        </ul>
        <h4>Micro Objects advanced methods example</h4>
        <pre><code class="language-c++">    http::obj_val zval4;
            zval4.set_array();
            float s[6]={83.3,77.75,60.45,83.3,77.75,45.6};
            for(unsigned int jjj=0;jjj&lt;6;jjj++)
            {
                http::obj_val z4;
                z4.set_object();
                z4[&quot;name&quot;]=&quot;sss&quot;+std::to_string(jjj);
                z4[&quot;score&quot;]=s[jjj];
                z4[&quot;id&quot;]=jjj+10;
                zval4.push(z4);
            }
            http::obj_val zval5=zval4.multi_sort(&quot;score&quot;,SORT_ASC);

            std::cout&lt;&lt;&quot;------&quot;&lt;&lt;std::endl;
            if(zval5.is_array())
            {
                std::cout&lt;&lt;&quot;multi_sort score result: &quot;&lt;&lt;zval5.size()&lt;&lt;std::endl;
                for(auto &amp;a:zval5.as_array())
                {
                    if(a.is_object())
                    {
                        for(auto &amp;[aa,bb]:a.as_object())
                        {
                            std::cout&lt;&lt;&quot;zval5[&quot;&lt;&lt;aa&lt;&lt;&quot;]=&quot;&lt;&lt; bb.to_string()&lt;&lt;std::endl;
                        }
                    }
                    std::cout&lt;&lt;std::endl;
                }
            }

            http::obj_val zval6=zval4.multi_sort(&quot;score&quot;,SORT_ASC,&quot;id&quot;,SORT_DESC);
            std::cout&lt;&lt;&quot;------&quot;&lt;&lt;std::endl;
            if(zval6.is_array())
            {
                std::cout&lt;&lt;&quot;multi_sort score id result: &quot;&lt;&lt;zval6.size()&lt;&lt;std::endl;
                for(auto &amp;a:zval6.as_array())
                {
                    if(a.is_object())
                    {
                        for(auto &amp;[aa,bb]:a.as_object())
                        {
                            std::cout&lt;&lt;&quot;zval6[&quot;&lt;&lt;aa&lt;&lt;&quot;]=&quot;&lt;&lt; bb.to_string()&lt;&lt;std::endl;
                        }
                    }
                    std::cout&lt;&lt;std::endl;
                }
            }
            std::cout&lt;&lt;&quot;------&quot;&lt;&lt;std::endl;
        </code></pre>

        <p>Mainly used in complex object swapping programs, if it is not possible to use C++built-in objects or STL library methods.</p>
        <h3 id="ormcontent">ORM Introduction</h3>
        <p>The data imported in the installation environment section.</p>
        <p>The paozhu framework has built-in ORM objects and currently analyzes the MySQL protocol to facilitate integration with ORM. It also supports coroutine mode, which is not officially supported by MySQL.</p>
        <p>Config file at <code>conf/orm.conf</code></p>
        <pre><code>[default]
        type=main
        host=127.0.0.1
        port=3306
        dbname=hello_world
        user=benchmarkdbuser
        password=benchmarkdbpass
        pretable=
        maxpool=5
        dbtype=mysql
        #ssl=ON
        
        type=second
        host=127.0.0.1
        port=3306
        dbname=hello_world
        user=benchmarkdbuser
        password=benchmarkdbpass
        pretable=
        maxpool=20
        dbtype=mysql
        #ssl=ON
        </code></pre>
        <h3>ORM Config</h3>
        <p><code>type</code> The type is master-slave separation, and cache synchronization can be developed in the future. Currently, master-slave is preferred. Host '127.0.0.1' fills in the local address, MySQL must be greater than or equal to version 8 because MySQL 9 does not support old authenticationÔºå</p>
        <p><code>pretable</code> It is a table prefix, sometimes only one database permission can store multiple businesses in one database.</p>
        <p><code>dbtype</code> Currently supports MySQL.</p>
        <p><code>SSL</code> can be opened, especially when connecting remotely, enabling encrypted connections. Local SSL connections will not be enabled.</p>
        <h3>ORM Usage</h3>
        <p>The framework currently supports database to create cpp file conversion, so modifying the database can regenerate ORM files.</p>
        <p>After successful compilation</p>
        <pre><code># ./bin/paozhu_cli 
        
        paozhu_cli(1495,0x7ff85ac38fc0) malloc: nano zone abandoned due to inability to reserve vm space.
          model ÔΩú view | viewtocpp | control   
         Welcome to use cli to manage your MVC files„ÄÇ
        (m)model (v)view (f)viewtocpp or (c)control , (j)son ,x or q to exit[input m|v|f|c|j|]:
        </code></pre>
        <p>Enter m to select and generate ORM model file</p>
        <pre><code>
        paozhu_cli(1495,0x7ff85ac38fc0) malloc: nano zone abandoned due to inability to reserve vm space.
          model ÔΩú view | viewtocpp | control   
         Welcome to use cli to manage your MVC files„ÄÇ
        (m)model (v)view (f)viewtocpp or (c)control , (j)son ,x or q to exit[input m|v|f|c|j|]:m   
         üçÑ current path: /Users/hzq/paozhu
         1 hello_world
         3 paozhu_docs
         5 cppcms
        select db index:
        </code></pre>
        <p>Enter 1 to select the hello-world database to generate the file.</p>
        <pre><code>paozhu_cli(1495,0x7ff85ac38fc0) malloc: nano zone abandoned due to inability to reserve vm space.
          model ÔΩú view | viewtocpp | control   
         Welcome to use cli to manage your MVC files„ÄÇ
        (m)model (v)view (f)viewtocpp or (c)control , (j)son ,x or q to exit[input m|v|f|c|j|]:m
         üçÑ current path: /Users/hzq/paozhu
         1 hello_world
         3 paozhu_docs
         5 cppcms
        select db index:1
        show tables;
        create fortune table to models üöó
         create table metainfo file: /Users/hzq/paozhu/orm/include/fortunebase.h
        create world table to models üöó
         create table metainfo file: /Users/hzq/paozhu/orm/include/worldbase.h
        (m)model (v)view (f)viewtocpp or (c)control , (j)son ,x or q to exit[input m|v|f|c|j|]:x
        </code></pre>
        <p>Enter x to exit</p>
        <p>You can see the generated files in the/Users/hzq/paozhu/orm directory.</p>
        <pre><code>
        orm
        ‚îú‚îÄ‚îÄ include
        ‚îÇ   ‚îú‚îÄ‚îÄ fortune_mysql.h
        ‚îÇ   ‚îú‚îÄ‚îÄ fortunebase.h
        ‚îÇ   ‚îú‚îÄ‚îÄ world_mysql.h
        ‚îÇ   ‚îî‚îÄ‚îÄ worldbase.h
        ‚îú‚îÄ‚îÄ orm.h
        ‚îÇ
        models
        ‚îú‚îÄ‚îÄ Fortune.cpp
        ‚îú‚îÄ‚îÄ World.cpp
        ‚îî‚îÄ‚îÄ include
            ‚îú‚îÄ‚îÄ Fortune.h
            ‚îî‚îÄ‚îÄ World.h
        </code></pre>
        <p>The ORM directory is an entity file, consisting of two files: one is the end of the mysql.h for operating database query interfaces, and the other is the end of the data table entity mapping base.h, which is also an interface for operating query results. When updating this directory file, it will be overwritten because it corresponds one-to-one with the database table structure</p>
        <p>The models directory is the business code file, and we actually manipulate the files in the models directory. These two files, one cpp and one h, are automatically generated, but they are only generated once and will not be overwritten. In our own project system, we can add business code to them.</p>
        <p>For example</p>
        <p>auto myworld = orm::World();
        models directory  World.h</p>
        <p>This is the default database, such as the built-in CMS demo
        auto users = orm::cms::Sysuser();</p>
        <p>orm is namespae, Mainly used for ORM business
        CMS is the orm.conf file database configuration tag and also the generated CMS namespace, which facilitates database isolation and transformation. If it is [default], default can be omitted</p>
        <h3>ORM design philosophy</h3>
        <p>Why is it designed in this way? Actually, it is also a unique design of the Paozhu framework compared to other frameworks.</p>
        <ol>
        <li>A database can have multiple connections, so we don't have to know which connection to use.</li>
        <li>The database name may be very long, for example, a cloud host may automatically generate a database name that is tens of characters long, even with underscores.</li>
        <li>Personalized tags can be used, so that the name of the database is not important anymore.</li>
        <li>We use it to create namespace isolation table objects, so that many C++classes generated by databases do not conflict.</li>
        <li>ORM designs powerful and elegant chain writing, while Go and Rust have design flaws that prevent the use of chain writing.</li>
        </ol>
        <p>So <code>orm::cms::Sysuser();</code> Using CMS to isolate the 'sysuser' table entity C++ class will not conflict with tables with the same name in other databases.
        For example, <code>orm::erp::Sysuser();</code>  ERP is an ERP database tag, and the name of its database is not important,
        It doesn't matter if there is also a <code>sysuser</code> table.</p>
        <p>The reason for this design is that it is a business system, a single server program that can have many databases, and their table names can have duplicate names.
        In the future, there can be different databases, such as MySQL PG, which can be distributed on other machines.
        They can mix clusters, and individual server programs can also be clustered, because they have built-in read-write separation, and the write servers can be the same,
        Querying can allocate database servers in a fixed or dynamic manner, and the framework can be suitable for large business systems.
        Currently, the focus is on integrating a server with a database and business programs.</p>
        <h3>ORM usage example</h3>
        <p>The table model has two important member variables</p>
        <ul>
        <li>data     is a mapping of a single table data structure</li>
        <li>record   is a std::vector array</li>
        </ul>
        <p>Table Data Structure</p>
        <pre><code class="language-C++">struct meta{
         unsigned  int  id = 0; 
         int  randomnumber = 0;  
        } data;
        
        std::vector&lt;worldbase::meta&gt; record;
        </code></pre>
        <h4>ORM use for Coroutine</h4>
        <pre><code class="language-C++">//@urlpath(null,queries)
        asio::awaitable&lt;std::string&gt; techempowerqueries(std::shared_ptr&lt;httppeer&gt; peer)
        {
            peer-&gt;type(&quot;application/json; charset=UTF-8&quot;);
            peer-&gt;set_header(&quot;Date&quot;, get_gmttime());
        
            unsigned int get_num = peer-&gt;get[&quot;queries&quot;].to_int();
            if (get_num == 0)
            {
                get_num = 1;
            }
            else if (get_num &gt; 500)
            {
                get_num = 500;
            }
            auto myworld = orm::World();
            myworld.record.reserve(get_num);
            myworld.lock_conn();
            for (unsigned int i = 0; i &lt; get_num; i++)
            {
                myworld.wheresql.clear();
                unsigned int rd_num = rand_range(1, 10000);
                myworld.where(&quot;id&quot;, rd_num);
                co_await myworld.async_fetch_append();
            }
            myworld.unlock_conn();
            peer-&gt;output = myworld.to_json();
            co_return &quot;&quot;;
        }
        </code></pre>
        <ul>
        <li><code>orm::World();</code> It is an ORM table model with default connections, so there is no need for default</li>
        <li><code>myworld.lock_conn();</code> It's about fixing a connection, because using ORM connection pool method will rotate the use of connections.</li>
        <li><code>myworld.record.reserve(get_num);</code> The std::vector reserve„ÄÇ</li>
        <li><code>myworld.wheresql.clear();</code> Recommend using <code>myworld.clearWhere()</code> Method to clear conditions„ÄÇ</li>
        <li><code>myworld.where(&quot;id&quot;, rd_num);</code> Add where„ÄÇ</li>
        <li><code>co_await myworld.async_fetch_append();</code> It is an advanced usage that will attach data to the record object. Generally, <code>co_await myworld.async_fetch();</code> is used` It will clear the record object and then reassign it.</li>
        </ul>
        <p><code>peer-&gt;output = myworld.to_json();</code> Directly output JSON to the browser.</p>
        <h4>Synchronize the use of ORM</h4>
        <p>Normal business code runs in a thread, one thread by one connect at a time, which is a classic way.</p>
        <pre><code class="language-C++">//@urlpath(admin_islogin,admin/addtopic)
        std::string admin_addtopic(std::shared_ptr&lt;httppeer&gt; peer)
        {
            httppeer &amp;client = peer-&gt;get_peer();
            try
            {
                auto topicm = orm::cms::Topic();
                topicm.where(&quot;userid&quot;, client.session[&quot;userid&quot;].to_int()).asc(&quot;parentid&quot;).fetch();
        
                client.val[&quot;list&quot;].set_array();
                obj_val temp;
        
                for (unsigned int i = 0; i &lt; topicm.record.size(); i++)
                {
                    temp[&quot;id&quot;]       = topicm.record[i].topicid;
                    temp[&quot;parentid&quot;] = topicm.record[i].parentid;
                    temp[&quot;value&quot;]    = topicm.record[i].title;
                    client.val[&quot;list&quot;].push(temp);
                }
            }
            catch (std::exception &amp;e)
            {
                client.val[&quot;code&quot;] = 1;
            }
        
            peer-&gt;view(&quot;admin/addtopic&quot;);
            return &quot;&quot;;
        }
        </code></pre>
        <p><code>httppeer &amp;client = peer-&gt;get_peer();</code> Reference connection object</p>
        <p><code>auto topicm = orm::cms::Topic();</code>  Create an ORM model object, with the model source file located in the models directory,Topic is the database table nameÔºåIf a prefix is set, the framework will automatically remove it,<code>topicm.where</code> add sql whereÔºå<code>asc(&quot;parentid&quot;).fetch()</code> order <code>parentid</code> asc query Ôºå<code>.fetch()</code> send query command„ÄÇ</p>
        <h4>Page usage</h4>
        <p>If you don't want so much data to be paginated and retrieved, especially for network services that require bandwidth or CPU resourcesÔºåIt is best to use it as needed <code>.select(&quot;fieldname1,fieldname2&quot;)</code> Retrieve field data, use <code>.limit(pos,offset)</code> for range.</p>
        <p>Use <code>.page(page, 10, 5)</code> It has been automatically added <code>.limit(pos,offset)</code> to sql string,now only input <code>page</code> number.</p>
        <pre><code class="language-C++">auto [bar_min, bar_max, current_page, total_page] = artmodel.page(page, 10, 5);
        
        client.val[&quot;pageinfo&quot;].set_object();
        client.val[&quot;pageinfo&quot;][&quot;min&quot;]     = bar_min;
        client.val[&quot;pageinfo&quot;][&quot;max&quot;]     = bar_max;
        client.val[&quot;pageinfo&quot;][&quot;current&quot;] = current_page;
        client.val[&quot;pageinfo&quot;][&quot;total&quot;]   = total_page;
        </code></pre>
        <p><code>.page(page, 10, 5)</code> Return four numerical values,<code>bar_min</code> <code>bar_max</code> The range is determined by the input of 5, It consists of two pages of windows, with 10 per page,</p>
        <p>ORM where Other Methods</p>
        <p><code>whereLike(fieldname,searchword)</code> it's just &quot; and fieldname '%searchword%'&quot; alias</p>
        
        <p><code>whereAnd</code> it's just &quot; and fieldname = val &quot; alias</p>
        <p><code>whereIn</code> it's just &quot; and fieldname IN(val) &quot; alias</p>
    </div>
    <div class="container"> 
        <h3 id="Htmltemplate">Paozhu Framework View Beginner's Guide</h3>
        <p>Paozhu, as a C++web framework framework, is the MVC pattern, which now refers to the view function of V</p>
        <h4>1„ÄÅView Description</h4>
        <p>It is the content displayed to the browser, which is actually HTML content, similar to PHP scripting language output. So how do we operate C++? We put C++code in HTML and compile it into a C++. cpp file, which is resident in memory. This is also very fast. Hundreds of view files only require a few MB of memory, and one company project is about 1000 pages. It is estimated to have less than 10MB of memory, and if running in a scripting language, it will require a large amount of IO to read files. The framework compiles it directly into a program without the need for IO reading, which is extremely fast.</p>
        <h4>2„ÄÅCreate View File</h4>
        <p>We are in the view directory</p>
        <p>Create a login directory and then create a login.html file in the login directory</p>
        <p>view</p>
        <ul>
        <li>login
        <ul>
        <li>login.html</li>
        </ul>
        </li>
        </ul>
        <p>Probably like this</p>
        <h4>login.html file content</h4>
        <pre><code class="language-html">&lt;!doctype html&gt;
        &lt;html lang=&quot;en&quot;&gt;
          &lt;head&gt;
            &lt;meta charset=&quot;utf-8&quot;&gt;
            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;
            &lt;meta name=&quot;description&quot; content=&quot;&quot;&gt;
            &lt;meta name=&quot;author&quot; content=&quot;Mark Otto, Jacob Thornton, and Bootstrap contributors&quot;&gt;
            &lt;meta name=&quot;generator&quot; content=&quot;Hugo 0.101.0&quot;&gt;
            &lt;title&gt;Content Management System&lt;/title&gt;
        
            &lt;link href=&quot;/assets/dist/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;
          &lt;/head&gt;
          &lt;body class=&quot;text-center&quot;&gt;
            &lt;%c include_sub(&quot;home/header&quot;,obj); %&gt;
            &lt;div class=&quot;container text-center&quot;&gt;
              &lt;div class=&quot;row&quot;&gt;
                &lt;div class=&quot;col-3&quot;&gt;&lt;/div&gt;  
                &lt;div class=&quot;col-6&quot;&gt;
                  &lt;h2 id=&quot;horizontal-form&quot;&gt;CMS Admin &lt;/h2&gt;
                  &lt;form action=&quot;/cms/loginpost&quot; method=&quot;post&quot;&gt;
                    &lt;div class=&quot;row mb-3&quot;&gt;
                      &lt;label for=&quot;username&quot; class=&quot;col-sm-2 col-form-label&quot;&gt;Username&lt;/label&gt;
                      &lt;div class=&quot;col-sm-10&quot;&gt;
                        &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;username&quot; name=&quot;username&quot; value=&quot;admin&quot;&gt;
                      &lt;/div&gt;
                    &lt;/div&gt;
                    &lt;div class=&quot;row mb-3&quot;&gt;
                      &lt;label for=&quot;password&quot; class=&quot;col-sm-2 col-form-label&quot;&gt;Password&lt;/label&gt;
                      &lt;div class=&quot;col-sm-10&quot;&gt;
                        &lt;input type=&quot;password&quot; class=&quot;form-control&quot; id=&quot;password&quot; name=&quot;password&quot; value=&quot;123456&quot;&gt;
                      &lt;/div&gt;
                    &lt;/div&gt;
        
                    &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;Sign in&lt;/button&gt;
                  &lt;/form&gt;
              
                &lt;/div&gt;
         
              &lt;/div&gt;
            &lt;/div&gt;
        
          &lt;/body&gt;
          &lt;/html&gt;
        
        
        </code></pre>
        <p>include_sub(&quot;home/header&quot;,obj);</p>
        <p>The description also includes a subpage, and we will create a subpage directory called home in the view</p>
        <p>view</p>
        <ul>
        <li>home
        <ul>
        <li>header.html</li>
        </ul>
        </li>
        <li>login
        <ul>
        <li>login.html</li>
        </ul>
        </li>
        </ul>
        <p>Probably like this</p>
        <h4>The content of header.html is actually the header information of the webpage</h4>
        <pre><code class="language-html">
        &lt;style&gt;
          ul {
              list-style-type: none;
              margin: 0;
              padding: 0;
              overflow: hidden;
              background-color: #333;
          }
          
          li {
              float: left;
              border-right:1px solid #bbb;
          }
          
          li:last-child {
              border-right: none;
          }
          
          li a {
              display: block;
              color: white;
              text-align: center;
              padding: 14px 16px;
              text-decoration: none;
          }
          
          li a:hover:not(.active) {
              background-color: #111;
          }
          
          .active {
              background-color: #4CAF50;
          }
          &lt;/style&gt;
        &lt;ul&gt;
          &lt;li&gt;&lt;a class=&quot;active&quot; href=&quot;/&quot;&gt;HOME&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#news&quot;&gt;News&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#contact&quot;&gt;Contact&lt;/a&gt;&lt;/li&gt;
          &lt;li style=&quot;float:right&quot;&gt;&lt;a href=&quot;#about&quot;&gt;About&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
        
        &lt;h3&gt; subpage include_sub(&quot;home/header&quot;)Nav test |&lt;%c echo&lt;&lt;vinfo.get[&quot;aa&quot;].to_string(); %&gt;| &lt;/h3&gt;
             
         
        </code></pre>
        <p>echo&lt;&lt;vinfo.get[&quot;aa&quot;].to_string();</p>
        <p>This is the view tag C++code included in &lt;%c %&gt;</p>
        <p>echo is a buffer, which is assembled together with the external HTML</p>
        <p>Convert to C++ code</p>
        <p>It's like this</p>
        <p>echo&lt;&lt;&quot;Nav test |&quot;;</p>
        <p>echo&lt;&lt;vinfo.get[&quot;aa&quot;].to_string();</p>
        <p>echo&lt;&lt;&quot;| &lt;/h3&gt;&quot;;</p>
        <p>You can refer to the viewsrc/view/home/head.cpp code for details.</p>
        <h4>3„ÄÅ Compile view to cpp file</h4>
        <p>Run in the root directory of the website</p>
        <p>./bin/paozhu_cli</p>
        <p>Select 'f' to generate files</p>
        <pre><code class="language-c++">
        ./bin/paozhu_cli
        ./bin/paozhu_cli  model ÔΩú view | viewtocpp | control   
         üéâ Welcome to use cli to manage your MVC files„ÄÇ
        (m)model (v)view (f)viewtocpp or (c)control,x or q to exit[input m|v|f|c|]:f
         üçÑ current path: /Users/hzq/paozhu
        1 [+] view/home/header.html 	 time: 2022-12-12 13:1:41
        2 [+] view/login/login.html 	 time: 2022-12-12 13:1:26
         please input number to parse to cpp file.
         a update all , example: 1 3 4 5 enter key, q or x to exit,r reload 
         input number:a
        
        </code></pre>
        <p>We input f and compile it directly with the framework.</p>
        <p>Then enter a, and all modified or newly created view files will be converted to cpp files</p>
        <p>The file is saved in the viewsrc directory</p>
        <p>viewsrc</p>
        <ul>
        <li>
        <p>view</p>
        <ul>
        <li>login
        <ul>
        <li>login.cpp</li>
        </ul>
        </li>
        <li>home
        <ul>
        <li>header.cpp</li>
        </ul>
        </li>
        </ul>
        </li>
        <li>
        <p>include</p>
        <ul>
        <li>viewsrc.h</li>
        <li>regviewmethod.hpp</li>
        </ul>
        </li>
        </ul>
        <p>Probably like this</p>
        <p>The login.html header.html files have been converted to cpp files</p>
        <p>Two files in the include directory</p>
        <p>Viewsrc.h is the definition of all view file functions</p>
        <p>regviewmethod.hpp is a view registration function that the framework calls to register with the framework</p>
        <h4>Content of viewsrc.h file</h4>
        <pre><code class="language-c++">
        #ifndef __HTTP_VIEWSRC_ALL_METHOD_H
        #define __HTTP_VIEWSRC_ALL_METHOD_H
        
        #if defined(_MSC_VER) &amp;&amp; (_MSC_VER &gt;= 1200)
        #pragma once
        #endif // defined(_MSC_VER) &amp;&amp; (_MSC_VER &gt;= 1200)
        
        #include&lt;string&gt;
        #include&lt;map&gt;
        #include&lt;functional&gt;
        #include &quot;request.h&quot;
        #include &quot;viewso_param.h&quot;
        
        namespace http { 
        namespace view { 
        
        namespace home{ 
        
            std::string header(const struct view_param &amp;vinfo,http::obj_val &amp;obj);
        }
        
        namespace login{ 
        
            std::string login(const struct view_param &amp;vinfo,http::obj_val &amp;obj);
        }
        
        
        }
        
        }
        #endif
        
        </code></pre>
        <p>You can see that the views are all placed in the namespace, so there is no conflict between the view files in one directory and those in other directories with the same name.</p>
        <h4>regviewmethod.hpp registration function file content</h4>
        <pre><code class="language-c++">
        #ifndef __HTTP_REG_VIEW_METHOD_HPP
        #define __HTTP_REG_VIEW_METHOD_HPP
        
        #if defined(_MSC_VER) &amp;&amp; (_MSC_VER &gt;= 1200)
        #pragma once
        #endif // defined(_MSC_VER) &amp;&amp; (_MSC_VER &gt;= 1200)
        
        #include&lt;string&gt;
        #include&lt;map&gt;
        #include&lt;functional&gt;
        #include &quot;request.h&quot;
        #include &quot;viewso_param.h&quot;
        #include &quot;viewmethold_reg.h&quot;
        #include &quot;viewsrc.h&quot;
        
        namespace http
        {
          void _initview_method_regto(VIEW_REG  &amp;_viewmetholdreg)
          {
                         //create time: Mon, 12 Dec 2022 05:01:53 GMT
        
            _viewmetholdreg.emplace(&quot;home/header&quot;,http::view::home::header);
            _viewmetholdreg.emplace(&quot;login/login&quot;,http::view::login::login);
        
            } 
        }
        #endif
        
        </code></pre>
        <p>Two functions are registered on the callback function, which means a view file is a function</p>
        <p>Directory name and file name form a registration point</p>
        <p>Login/login is a registration point</p>
        <p>Controller peer-&gt;view(&quot;login/login&quot;);  calling method.</p>
        <h4>4„ÄÅ View testing</h4>
        <p>We have created the view, now let's test it</p>
        <p>Follow the introductory chapter of Hello World</p>
        <p><code>controller/src</code>Directory create <code>testview.cpp</code> file</p>
        <p>Probably like this</p>
        <h4>testview.cpp</h4>
        <pre><code class="language-c++">#include &lt;chrono&gt;
        #include &lt;thread&gt;
        #include &quot;httppeer.h&quot;
        #include &quot;testview.h&quot;
        namespace http
        {
               //@urlpath(null,testview)
              std::string testloginview(std::shared_ptr&lt;httppeer&gt; peer)
              {
                    httppeer &amp;client = peer-&gt;getpeer();
                    client &lt;&lt; &quot; view test &quot;;
                    // client &lt;&lt; client.gethosturl();
                    // client&lt;&lt;&quot;&lt;p&gt;&lt;a href=\&quot;&quot;&lt;&lt;client.gethosturl()&lt;&lt;&quot;/showcookie\&quot;&gt;show&lt;/a&gt;&lt;/p&gt;&quot;;
        
                    peer-&gt;view(&quot;login/login&quot;);
                    return &quot;&quot;;
              }
        
        }
        
        </code></pre>
        <p>Map testview to testloginview function, the two names can be different.</p>
        <p><code>http://localhost/testview</code> You can access our testloginview function</p>
        <h4>5„ÄÅCompile</h4>
        <p>Everything is ready, let's start compiling</p>
        <p>Return to the project root directory and enter the build directory</p>
        <p>cmake ..</p>
        <p>make</p>
        <p>Then go back to the root directory or open a new Terminal Command</p>
        <p>cd ..</p>
        <p>./bin/paozhu #In Linux use: sudo ./bin/paozhu</p>
        <p>Open with a browser</p>
        <p>http://localhost/testview</p>
        <p>You can see the content of the view now</p>

        <div class="container">

            <h3 id="jsonencode">JSON and struct conversion function json_encode json_decode</h3>
            <p>The framework has built-in structure and JSON conversion functions, reducing the workload of writing code</p>
            <h4>Usage</h4>
    
            <p>The framework provides two function operations <code>json_encode</code> <code>json_decode</code> that can be on structures or class objects„ÄÅ</p>
    
            <p>std::string json_encode(obj)</p>
            <p>std::string json_encode(std::vector&lt;obj&gt;)</p>
    
            <p>Encoding objects as JSON supports arrays or objects</p>
    
            <p>int json_decode(obj,json_string)</p>
            <p>int json_decode(std::vector&lt;obj&gt;,json_string)</p>
    
            <p>Decoding JSON strings to objects</p>
            <h4>Theory</h4>
            <p><code>common/json_reflect_headers.h</code> It is the header file referenced by all reflection objects</p>
    
            <p>This file was generated by<code>paozhu_cli</code></p>
    
            <p>You need to create the corresponding type file in the libs directory, and then run paozhu_cli to generate it. The framework directly analyzes the type file to generate the corresponding code. Currently, it supports commonly used structures, which can be nested in multiple layers or reference structures that are also reflective.</p>
            <h4>Example of use</h4>
            <p>Create test file <code>libs/department/department_type.h</code></p>
            <pre><code class="language-cpp">
                #ifndef LIBS_DEPARTMENT_TYPE_H
                #define LIBS_DEPARTMENT_TYPE_H
                #include &lt;iostream&gt;
                #include &lt;string&gt;
                #include &lt;vector&gt;
                #include &lt;sstream&gt;
                #include &lt;sstream&gt;
                #include "unicode.h"
                
                namespace psy
                { 
                //@reflect json to_json from_json
                struct department_outjson_t
                {
                  unsigned int id          = 0;
                  unsigned int key         = 0;
                  unsigned int value       = 0;
                  unsigned int parentid    = 0;
                  unsigned int bianzhi_num = 0;
                  bool isopen              = true;
                  bool _is_use             = false;
                  std::string title;
                  std::string desc;
                  std::vector&lt;department_outjson_t&gt; children;
                  std::string to_json(std::string aa="",int offset=0);
                  unsigned int from_json()
                  {
                        //**aaaaa
                        /*
                        aaaa [][}]
                        */
                        char b='}';
                        if(b=='{')
                        {
                            std::cout&lt;&lt;"assss}sss}{ssss}sss}"&lt;&lt;std::endl;
                        }
                        return 0;
                  }
                };
                
                //@reflect json to_json from_json
                struct department_listoutjson_t
                {
                  unsigned int code=0;
                  struct department_tables
                  {
                    std::vector&lt;department_outjson_t&gt; list;
                    unsigned int total=0;
                  } data;
                  std::vector&lt;std::vector&lt;std::string&gt;&gt; names;
                };
                
                } // namespace psy
                #endif            
            </code></pre>     
            
            <p><code>//@reflect json</code> It is a framework analysis source code extraction flag, which must be a struct or class starting with this, otherwise it will not work.</p>
    
            <p>We create two structures, with one nested within the other, to facilitate business code operations. to_json from_json is a testing framework that analyzes whether the source code correctly skips these functions</p>
    
            <p>Variables starting with an underscore will not be output to a JSON string</p>
            <h4>Generate entity code for the object <code>json_encode</code> and <code>json_decode</code> </h4>
            <pre><code class="language-shell">
            sudo ./bin/paozhu_cli
            </code></pre>    
            <pre><code class="language-shell">
            ./bin/paozhu_cli  model | view | viewtocpp | control   
            üéâ Welcome to use cli to manage your MVC files„ÄÇ
            (m)model (v)view (f)viewtocpp or (c)control , (j)son ,x or q to exit[input m|v|f|c|j|]:
            </code></pre>  
    
            <p>Input j</p>
            <p>You can see the generated file now</p>
            <pre><code class="language-shell">
            1 /Users/hzq/paozhu/libs/department/department_type_jsonreflect.cpp
            (m)model (v)view (f)viewtocpp or (c)control , (j)son ,x or q to exit[input m|v|f|c|j|]:
            </code></pre>   
            
            <h4>json_encode json_decode Example of use</h4>
    
            <p>Reference <code>controller/src/testjsonreflect.cpp</code></p>
    
            <pre><code class="language-cpp">
            #include &lt;chrono&gt;
            #include &lt;thread&gt;
            #include "httppeer.h"
            #include "testjsonreflect.h"
            #include "json_reflect_headers.h"
            #include "array_to_tree.h"
            namespace http
            {
            //@urlpath(null,testjsonreflect)
            std::string testjsonreflect(std::shared_ptr&lt;httppeer&gt; peer)
            {
                httppeer &client = peer-&gt;getpeer();
                // client &lt;&lt; " json reflect üß® Paozhu c++ web framework ";
    
                psy::department_outjson_t deps_json_one;
                std::vector&lt;psy::department_outjson_t&gt; depsjsonlist;
    
                deps_json_one.id          = 38;
                deps_json_one.key         = 38;
                deps_json_one.value       = 38;
                deps_json_one.parentid    = 0;
                deps_json_one.isopen      = true;
                deps_json_one.title       = "First Item";
                deps_json_one.desc        = "First Item";
                deps_json_one.bianzhi_num = 12;
    
                depsjsonlist.push_back(deps_json_one);
    
                deps_json_one.id          = 48;
                deps_json_one.key         = 48;
                deps_json_one.value       = 48;
                deps_json_one.parentid    = 0;
                deps_json_one.isopen      = true;
                deps_json_one.title       = "Second Item";
                deps_json_one.desc        = "Second memo";
                deps_json_one.bianzhi_num = 16;
    
                depsjsonlist.push_back(deps_json_one);
    
                deps_json_one.id          = 58;
                deps_json_one.key         = 58;
                deps_json_one.value       = 58;
                deps_json_one.parentid    = 48;
                deps_json_one.isopen      = true;
                deps_json_one.title       = "Three Item";
                deps_json_one.desc        = "Three memo";
                deps_json_one.bianzhi_num = 22;
    
                depsjsonlist.push_back(deps_json_one);
    
                psy::department_listoutjson_t depout_data;
    
                array_to_tree&lt;psy::department_outjson_t&gt;(depout_data.data.list, depsjsonlist);
    
                depout_data.code = 0;
                // depout_data.data.list=depsjsonlist; //has array_to_tree
                depout_data.data.total = 0;
    
                std::string jsondep_str = psy::json_encode(depout_data);
    
                psy::department_listoutjson_t new_depout_data;
                psy::json_decode(new_depout_data, jsondep_str);
                std::cout &lt;&lt; "data.list:" &lt;&lt; depout_data.data.list.size() &lt;&lt; std::endl;
                std::cout &lt;&lt; "data.list:" &lt;&lt; new_depout_data.data.list.size() &lt;&lt; std::endl;
    
                std::string jsondep_str_temp = psy::json_encode(new_depout_data);
    
                client &lt;&lt; jsondep_str_temp;
                client.out_jsontype();
                return "";
            }
    
            } // namespace http    
            </code></pre>   
            <p>We first convert the array into a tree, and then encode the test object into a JSON string</p>
            <p>std::string jsondep_str = psy::json_encode(depout_data);</p>
            <p>Then decode the jsondep_str variable to the new object</p>
            <p><code>psy::json_decode(new_depout_data, jsondep_str);</code> </p>
    
            <p>And then we'll do it again <code>std::string jsondep_str_temp = psy::json_encode(new_depout_data);</code></p>
    
            <p>Then output jsondep_str_temp, See if it meets our expectations</p>
    
        </div>      

        <h3 id="Troubleshooting">Troubleshooting in C++ Production Environment</h3>
        <p>The framework has enabled ASAN, and if it is detected by ASAN during debugging, it will indicate which line is problematic.</p>
        <p>The production environment is difficult to see due to the lack of output reasons.</p>
        <p>The compilation parameters for the production environment.</p>
        <pre><code class="language-shell">
        mkdir build
        cd build
        cmake .. -DCMAKE_BUILD_TYPE=Release #OR cmake .. -DCMAKE_BUILD_TYPE=Release -DENABLE_GD=ON
        make -j8
        </code></pre>
        <p>Need to install <code>gdb</code> and <code>coredumpctl</code></p>
        <p>The framework will be checked every minute, at <code>log</code> directory have a <code>restart_server</code> file</p>
        <p>If we need to retrieve a sample of the process stack, we can <code>touch log/start_Server</code> so that the process can restart</p>
        <p>have access to <code>pstree -aup</code> view process status</p>
        <p>If the sample has already been taken, I need to analyze the process stack situation</p>
        <p>view coredump info</p>
        <pre><code>
        coredumpctl list
        coredumpctl info
        </code></pre>
        <p>Looking directly online 1524 pid, That's what I saw before<code>pstree up</code></p>
        <pre><code>coredumpctl gdb 1524</code></pre>
        <p><code>bt</code> can be view it</p>
        <p>After entering, we can save it and view it in the current<code>thread_info.txt</code>file.</p>
        <pre><code>
        set logging file thread_info.txt
        set logging enabled on
        thread apply all bt
        set logging enabled off
        </code></pre>
        <p>The core coredump file is usually located in</p>
        <pre><code>/var/lib/systemd/coredump</code></pre>
        <p>If compiled using -g, you will see something similar to the following, usually displaying what various threads are currently doing</p>
        <pre><code>Thread 17 (Thread 0x7fd9f16b9640 (LWP 10658)):
                  #0  http::hash_objkey (key=&amp;quot;data:image/php;base64,PD9waHAgJE8wME9PMD11cmxkZWNvZGUoIiU3OCUzNCU2My&amp;quot;...) at /www/paozhu/vendor/httpserver/src/request.cpp:54
                  #1  0x000000000060032f in http::obj_val::operator[] (this=0x7fd9cc01e520, key=&amp;quot;data:image/php;base64,PD9waHAgJE8wME9PMD11cmxkZWNvZGUoIiU3OCUzNCU2MyU2RiUyRiU3MCUzOSU3OSU3MSU2RSU2NCUyRCU2QyU3MiU2QiU2NCU2NyU1RiU&amp;quot;...) at /www/paozhu/vendor/httpserver/src/request.cpp:315
                  #2  0x00000000005a990c in http::httpparse::procssxformurlencoded (this=0x7fd9b400d370) at /www/paozhu/vendor/httpserver/src/http_parse.cpp:389
                  #3  0x00000000005b1bfa in http::httpparse::process (this=0x7fd9b400d370, buffer=0x2e223c0 &amp;quot;POST /public/static/lib/webuploader/0.1.5/server/preview.php HTTP/1.1\r\nHost: www. paozhu.org\r\nUser-Agent: Mozilla/5.0 AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0\r\nAccept-Encoding: gzip, deflate&amp;quot;..., buffersize=964) at /www/paozhu/vendor/httpserver/src/http_parse.cpp:2823
                  
        </code></pre>
        <p><a href="CMakeLists_debug_product.txt">Reference to CMakeLists.txt</a></p>
</div>
</body>

</html>